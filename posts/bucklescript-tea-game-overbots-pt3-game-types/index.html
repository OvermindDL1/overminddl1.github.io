<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="Bucklescript-TEA tutorial game OverBots Pt.3 - Game Types">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
<title>Bucklescript-Tea Game OverBots Pt.3 - Game Types | Hyperglot Programmer</title>
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en" type="text/css">
<link rel="stylesheet" href="//storage.googleapis.com/code.getmdl.io/1.1.3/material.blue_grey-blue.min.css">
<link href="../../assets/colorbox/css/colorbox.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="alternate" type="application/atom+xml" title="Atom" href="../../index.atom">
<link rel="canonical" href="http://blog.overminddl1.com/posts/bucklescript-tea-game-overbots-pt3-game-types/">
<meta name="description" content="Bucklescript-TEA tutorial game OverBots Pt.3 - Game Types">
<meta name="author" content="OvermindDL1">
<link rel="prev" href="../bucklescript-tea-game-overbots-pt2-overall-design-and-the-views/" title="Bucklescript-Tea Game Overbots Pt.2 - Overall Design and the View" type="text/html">
<meta property="og:site_name" content="Hyperglot Programmer">
<meta property="og:title" content="Bucklescript-Tea Game OverBots Pt.3 - Game Types">
<meta property="og:url" content="http://blog.overminddl1.com/posts/bucklescript-tea-game-overbots-pt3-game-types/">
<meta property="og:description" content="Bucklescript-TEA tutorial game OverBots Pt.3 - Game Types">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-05-16T07:08:02-06:00">
<meta property="article:tag" content="bucklescript">
<meta property="article:tag" content="bucklescript-tea">
<meta property="article:tag" content="overbots">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container" class="site mdl-layout mdl-js-layout
    ">
         
    <header id="header" class="mdl-layout__header site-header
    "><div class="mdl-layout__header-row site-header__title-row
        ">
            
    <h1 id="brand" class="mdl-layout__title site-title">
        <a href="http://blog.overminddl1.com/" title="Hyperglot Programmer" rel="home">
                <span id="blog-title" class="mdl-color-text--primary-contrast">Hyperglot Programmer</span>
        </a>
    </h1>

            <div class="mdl-layout-spacer"></div>
            <span class="sr-only">main navigation</span>
            <nav class="mdl-navigation site-header__navigation"><a class="mdl-navigation__link" href="../../archives/">Archive</a>
                      <a class="mdl-navigation__link" href="../../categories/">Categories</a>
                      <a class="mdl-navigation__link" href="../../tags/">Tags</a>
                      <a class="mdl-navigation__link" href="../../rss.xml">RSS feed</a>
              
              
            </nav><div class="site-header__search" role="search">
                    
<!-- Google custom search -->
<form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
  <input class="mdl-textfield__input" type="search" id="searchinput"><label class="mdl-textfield__label mdl-color-text--blue-50" for="searchinput">Search...</label>
</div>
<input type="hidden" name="sitesearch" value="http://blog.overminddl1.com/">
</form>
<!-- End of custom search -->

                </div>
            

        </div>
    </header><div id="drawer" class="mdl-layout__drawer site-drawer
mdl-layout--small-screen-only
    ">
        <div class="mdl-layout__title site-drawer__title">
                <span>Hyperglot Programmer</span>
        </div>
        <div class="site-drawer__description">
            
<!-- Google custom search -->
<form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
  <input class="mdl-textfield__input" type="search" id="searchinput"><label class="mdl-textfield__label " for="searchinput">Search...</label>
</div>
<input type="hidden" name="sitesearch" value="http://blog.overminddl1.com/">
</form>
<!-- End of custom search -->

        </div>
        <span class="sr-only">side navigation</span>
        <nav class="mdl-navigation site-drawer__navigation"><a class="mdl-navigation__link" href="../../archives/">Archive</a>
                    <a class="mdl-navigation__link" href="../../categories/">Categories</a>
                    <a class="mdl-navigation__link" href="../../tags/">Tags</a>
                    <a class="mdl-navigation__link" href="../../rss.xml">RSS feed</a>
            
            
        </nav>
</div>

    

         <main id="content" class="mdl-layout__content"><div class="site-post site-card mdl-grid">
    <div class="mdl-card mdl-cell mdl-cell--12-col
    site-post-code
    mdl-shadow--4dp
">
        <article class="h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="mdl-card__media"></div>
            
    
    <div class="mdl-card__title">
        <h1 class="mdl-card__title-text p-name entry-title" itemprop="headline name">Bucklescript-Tea Game OverBots Pt.3 - Game Types</h1>
    </div>

    <meta name="description" itemprop="description" content="Bucklescript-TEA tutorial game OverBots Pt.3 - Game Types">
<div class="mdl-card__supporting-text e-content entry-content" itemprop="articleBody text">
                <div>
<p>Welcome back to developing OverBots with Bucklescript-TEA!</p>
<p>This time we are going to follow a 'type-driven' style of design.  This is pretty foreign in the javascript world due to limitations of the javascript language, but it is an excellent methodology to help you figure out the design of your application before you ever write executable code, thus helping you to do it properly the first time.</p>
<!-- TEASER_END -->
<p>However, considering this game has no real design behind it, this may of course change a few times, but over the course of this post let's see if we can help figure out what that design should be first and foremost.  :-)</p>
<div class="section" id="type-driven-design">
<h2>Type-Driven Design</h2>
<p>The way most programs are designed, especially in javascript, is either a top-down or bottom-up approach, usually people start with just an open canvas of a page and they start writing javascript to fill it in, what this means is that the overall 'model' of the application changes wildly over the course of it's life, and indeed even the individual variables often change from one revision to the next, not just in their value but also in their types, and this makes tracking down bugs significantly harder.  Languages like <a class="reference external" href="https://www.typescriptlang.org/">Typescript</a>, which adds a layer of typing on normal javascript, help catch these classes of bugs, however it does not really help people to design by types as you are still just decorating variables with types instead of designing the types <em>First</em>.  There are quite a variety of posts and pages and information about Type-Driven design by searching, so I highly suggest to feel free to do so if this is new to you as I will only talk about it cursorily, but in essence it is to design an application by figuring out the data first, then writing code to manipulate that data; you never really want, say, a bare integer around, everything needs a typed name somehow, prevents you from mixing concerns that should not be mixed, preventing entire other classes of common bugs.</p>
</div>
<div class="section" id="game-types">
<h2>Game Types</h2>
<p>The game itself will have a variety of types to hold a variety of data, and overall this will likely be a very generic incremental game, so let's start with the parts that about every incremental game has.</p>
<div class="section" id="messages">
<h3>Messages</h3>
<p>A message box let's us do a little hint of a story, little though it often is in such game, as well as giving information to the player about what is happened and/or what they have done for reference later.  I'll create this type in the <tt class="docutils literal">src/overbots_types.ml</tt> file for now:</p>
<pre class="code ocaml"><a name="rest_code_92dbfa1341104d52801d48f524f5c193-1"></a><span class="k">type</span> <span class="n">game_msg</span> <span class="o">=</span>
<a name="rest_code_92dbfa1341104d52801d48f524f5c193-2"></a>  <span class="o">|</span> <span class="nc">TimeMsg</span> <span class="k">of</span> <span class="nn">Tea</span><span class="p">.</span><span class="nn">Time</span><span class="p">.</span><span class="n">t</span> <span class="o">*</span> <span class="kt">string</span>
</pre>
<p>I'm making this a variant, even if just a single constructor variant, for two reasons.  The first is that it keeps everything even more strongly typed, imagine if I got another tuple somewhere that held a time and string for some other reason, I could accidentally mix them.  Second is that I may want to expand it later, maybe a URL message or something, and this leaves that open to do so more easily.  I'll follow this pattern through-out typing everything.</p>
</div>
<div class="section" id="resources">
<h3>Resources</h3>
<p>Every incremental game is about the management and acquisition of resources, a min-max strategy that the player does effectively manually (and this is the primary addiction of these kind of games), so I will need a primary structure to hold all of the resource values, and I could do this in a few different ways:</p>
<ul class="simple">
<li>
<strong>Record:</strong> A record means that everything is explicitly named, no worry about mixing things, however it also means that for every resource message that I'd have to make a unique one, and that could get very wordy very fast in a whole lot of different places, so this may not be done standalone.</li>
<li>
<strong>Map:</strong> I could make a dictionary, the key could be strings, which that is certainly not type safe, or I could give all resource types a variant identifier, which would be type safe.  Access is a little slower but not enough to really matter, however updating would be faster if only a few fields are updated instead of all of them, however that also means that I'll have to scatter the types of all the resources everywhere, which is less verbose than records for sure, but still not exactly short.</li>
<li>
<strong>Modules:</strong> OCaml has powerful modules, you can make modules that make modules that make modules (this is how the Map module works for example), you can pack modules up as a value and pass them around then unpack and access them with ease.  The actual creation of the resources would be a little more wordy, however the usage would be wonderfully succinct, readable, and expandable.  I could even update the modules over time as it goes on as well.</li>
</ul>
<p>I think the modules will be the best here, to create a new resource will just involve creating a single new module instead of peppering ID types all over the place.</p>
<p>However, for the modules there are 2 main methods we can use, we can store the data inside the module, or we can store it outside the module.  If we store it inside our module then we will have to store the modules themselves in the model, that starts getting hefty and is entirely needless.  On the other hand we could store the raw data, the values of the resources, on the model but access the modules elsewhere, which will make it very succinct over all, however we will need a way to link the modules to something on the model, and for that we could still use a record, map, or something else.  I think I will choose a map as it will reduce the update count but it importantly also means that I can access it more directly without needing to know the specific names of everything.  To do this I'll need to index it someway, so I think I'll create a variant of names.  To start I'll add to <tt class="docutils literal">src/overbots_types.ml</tt> before the <tt class="docutils literal">model</tt> type:</p>
<!-- code::ocaml

type resource_flag =
| Energy
| IronOxide
| RawSilicon
module ResourceMap = Map.Make(struct type t = resource_flag let compare = compare end)
type resource_value = float
type resource_values = resource_value ResourceMap.t -->
<p>So I've defined the names of the resources that I will support, the <tt class="docutils literal">Map</tt> type that uses it as the key, and I've defined the type that I want the resources to be as well as named a few starting resources.</p>
<p>In another file, named <tt class="docutils literal">src/overbots_resources.ml</tt> I'll put the module information and the initial resource definition:</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-1"> 1</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-2"> 2</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-3"> 3</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-4"> 4</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-5"> 5</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-6"> 6</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-7"> 7</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-8"> 8</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-9"> 9</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-10">10</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-11">11</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-12">12</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-13">13</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-14">14</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-15">15</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-16">16</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-17">17</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-18">18</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-19">19</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-20">20</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-21">21</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-22">22</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-23">23</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-24">24</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-25">25</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-26">26</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-27">27</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-28">28</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-29">29</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-30">30</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-31">31</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-32">32</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-33">33</a>
<a href="#rest_code_6a5329ef3d0b4ae8a9376aad897cf488-34">34</a></pre></div></td>
<td class="code"><pre class="code ocaml"><a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-1"></a><span class="k">open</span> <span class="nc">Overbots_types</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-2"></a>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-3"></a><span class="k">module</span> <span class="k">type</span> <span class="nc">Resource</span> <span class="o">=</span> <span class="k">sig</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-4"></a>  <span class="k">val</span> <span class="n">id</span> <span class="o">:</span> <span class="n">resource_flag</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-5"></a>  <span class="k">val</span> <span class="n">shown</span> <span class="o">:</span> <span class="n">model</span> <span class="o">-&gt;</span> <span class="kt">bool</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-6"></a>  <span class="k">val</span> <span class="n">get_value_range</span> <span class="o">:</span> <span class="n">model</span> <span class="o">-&gt;</span> <span class="n">resource_value</span> <span class="o">*</span> <span class="n">resource_value</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-7"></a><span class="k">end</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-8"></a>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-9"></a>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-10"></a><span class="k">module</span> <span class="nc">Energy</span> <span class="o">:</span> <span class="nc">Resource</span> <span class="o">=</span> <span class="k">struct</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-11"></a>  <span class="k">let</span> <span class="n">id</span> <span class="o">=</span> <span class="nc">Energy</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-12"></a>  <span class="k">let</span> <span class="n">shown</span> <span class="o">_</span><span class="n">model</span> <span class="o">=</span> <span class="bp">true</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-13"></a>  <span class="k">let</span> <span class="n">get_value_range</span> <span class="o">_</span><span class="n">model</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">,</span> <span class="mi">100</span><span class="o">.</span><span class="mi">0</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-14"></a><span class="k">end</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-15"></a>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-16"></a><span class="k">module</span> <span class="nc">IronOxide</span> <span class="o">:</span> <span class="nc">Resource</span> <span class="o">=</span> <span class="k">struct</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-17"></a>  <span class="k">let</span> <span class="n">id</span> <span class="o">=</span> <span class="nc">IronOxide</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-18"></a>  <span class="k">let</span> <span class="n">shown</span> <span class="o">_</span><span class="n">model</span> <span class="o">=</span> <span class="bp">true</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-19"></a>  <span class="k">let</span> <span class="n">get_value_range</span> <span class="o">_</span><span class="n">model</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">,</span> <span class="mi">10</span><span class="o">.</span><span class="mi">0</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-20"></a><span class="k">end</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-21"></a>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-22"></a><span class="k">module</span> <span class="nc">RawSilicon</span> <span class="o">:</span> <span class="nc">Resource</span> <span class="o">=</span> <span class="k">struct</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-23"></a>  <span class="k">let</span> <span class="n">id</span> <span class="o">=</span> <span class="nc">RawSilicon</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-24"></a>  <span class="k">let</span> <span class="n">shown</span> <span class="o">_</span><span class="n">model</span> <span class="o">=</span> <span class="bp">true</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-25"></a>  <span class="k">let</span> <span class="n">get_value_range</span> <span class="o">_</span><span class="n">model</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">,</span> <span class="mi">2</span><span class="o">.</span><span class="mi">0</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-26"></a><span class="k">end</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-27"></a>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-28"></a>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-29"></a><span class="k">let</span> <span class="n">all_resources</span> <span class="o">=</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-30"></a>  <span class="k">let</span> <span class="k">open</span> <span class="nc">ResourceMap</span> <span class="k">in</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-31"></a>  <span class="n">empty</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-32"></a>  <span class="o">|&gt;</span> <span class="n">add</span> <span class="nc">Energy</span> <span class="o">(</span><span class="k">module</span> <span class="nc">Energy</span> <span class="o">:</span> <span class="nc">Resource</span><span class="o">)</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-33"></a>  <span class="o">|&gt;</span> <span class="n">add</span> <span class="nc">IronOxide</span> <span class="o">(</span><span class="k">module</span> <span class="nc">IronOxide</span> <span class="o">:</span> <span class="nc">Resource</span><span class="o">)</span>
<a name="rest_code_6a5329ef3d0b4ae8a9376aad897cf488-34"></a>  <span class="o">|&gt;</span> <span class="n">add</span> <span class="nc">RawSilicon</span> <span class="o">(</span><span class="k">module</span> <span class="nc">RawSilicon</span> <span class="o">:</span> <span class="nc">Resource</span><span class="o">)</span>
</pre></td>
</tr></table>
<p>I think I also want the resources shown categorized, so I'll toss the definition here too after the above, lot of strings because the front-end is strings, the first element is the displayed name, the second the class name, the third is the list of resources:</p>
<pre class="code ocaml"><a name="rest_code_300d0e317ddb4d469c0460d28b5b0e37-1"></a><span class="k">let</span> <span class="n">displayed_resources</span> <span class="o">=</span> <span class="o">[</span>
<a name="rest_code_300d0e317ddb4d469c0460d28b5b0e37-2"></a>  <span class="o">(</span><span class="s2">""</span><span class="o">,</span> <span class="s2">"global"</span><span class="o">,</span> <span class="o">[</span>
<a name="rest_code_300d0e317ddb4d469c0460d28b5b0e37-3"></a>      <span class="nc">Energy</span><span class="o">,</span> <span class="s2">"energy"</span><span class="o">;</span>
<a name="rest_code_300d0e317ddb4d469c0460d28b5b0e37-4"></a>    <span class="o">]);</span>
<a name="rest_code_300d0e317ddb4d469c0460d28b5b0e37-5"></a>  <span class="o">(</span><span class="s2">"Raw"</span><span class="o">,</span> <span class="s2">"raw"</span><span class="o">,</span> <span class="o">[</span>
<a name="rest_code_300d0e317ddb4d469c0460d28b5b0e37-6"></a>      <span class="nc">IronOxide</span><span class="o">,</span> <span class="s2">"ironoxide"</span><span class="o">;</span>
<a name="rest_code_300d0e317ddb4d469c0460d28b5b0e37-7"></a>      <span class="nc">RawSilicon</span><span class="o">,</span> <span class="s2">"rawsilicon"</span><span class="o">;</span>
<a name="rest_code_300d0e317ddb4d469c0460d28b5b0e37-8"></a>    <span class="o">]);</span>
<a name="rest_code_300d0e317ddb4d469c0460d28b5b0e37-9"></a><span class="o">]</span>
</pre>
<p>And now to toss in a set of helpers that will be useful later:</p>
<pre class="code ocaml"><a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-1"></a><span class="k">let</span> <span class="n">get_resource_module</span> <span class="n">rid</span> <span class="o">=</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-2"></a>  <span class="nn">ResourceMap</span><span class="p">.</span><span class="n">find</span> <span class="n">rid</span> <span class="n">all_resources</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-3"></a>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-4"></a>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-5"></a><span class="k">let</span> <span class="n">get_resource_value</span> <span class="n">rid</span> <span class="n">model</span> <span class="o">=</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-6"></a>  <span class="nn">ResourceMap</span><span class="p">.</span><span class="n">find</span> <span class="n">rid</span> <span class="n">model</span><span class="o">.</span><span class="n">resource_values</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-7"></a>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-8"></a>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-9"></a><span class="k">type</span> <span class="n">resource_value_state</span> <span class="o">=</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-10"></a>  <span class="o">|</span> <span class="nc">ValueTooLow</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-11"></a>  <span class="o">|</span> <span class="nc">ValueTooHigh</span> <span class="k">of</span> <span class="n">model</span> <span class="o">*</span> <span class="n">resource_value</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-12"></a>  <span class="o">|</span> <span class="nc">ValueSuccess</span> <span class="k">of</span> <span class="n">model</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-13"></a>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-14"></a><span class="k">let</span> <span class="n">set_resource_value</span> <span class="n">rid</span> <span class="k">value</span> <span class="n">model</span> <span class="o">=</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-15"></a>  <span class="k">let</span> <span class="k">module</span> <span class="nc">R</span> <span class="o">=</span> <span class="o">(</span><span class="k">val</span> <span class="n">get_resource_module</span> <span class="n">rid</span><span class="o">)</span> <span class="k">in</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-16"></a>  <span class="k">let</span> <span class="n">rmin</span><span class="o">,</span> <span class="n">rmax</span> <span class="o">=</span> <span class="nn">R</span><span class="p">.</span><span class="n">get_value_range</span> <span class="n">model</span> <span class="k">in</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-17"></a>  <span class="k">if</span> <span class="k">value</span> <span class="o">&lt;</span> <span class="n">rmin</span> <span class="k">then</span> <span class="nc">ValueTooLow</span> <span class="k">else</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-18"></a>  <span class="k">if</span> <span class="k">value</span> <span class="o">&gt;</span> <span class="n">rmax</span> <span class="k">then</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-19"></a>    <span class="k">let</span> <span class="n">resource_values</span> <span class="o">=</span> <span class="nn">ResourceMap</span><span class="p">.</span><span class="n">add</span> <span class="n">rid</span> <span class="n">rmax</span> <span class="n">model</span><span class="o">.</span><span class="n">resource_values</span> <span class="k">in</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-20"></a>    <span class="nc">ValueTooHigh</span> <span class="o">({</span><span class="n">model</span> <span class="k">with</span> <span class="n">resource_values</span><span class="o">},</span> <span class="k">value</span><span class="o">-.</span><span class="n">rmax</span><span class="o">)</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-21"></a>  <span class="k">else</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-22"></a>    <span class="k">let</span> <span class="n">resource_values</span> <span class="o">=</span> <span class="nn">ResourceMap</span><span class="p">.</span><span class="n">add</span> <span class="n">rid</span> <span class="k">value</span> <span class="n">model</span><span class="o">.</span><span class="n">resource_values</span> <span class="k">in</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-23"></a>    <span class="nc">ValueSuccess</span> <span class="o">{</span><span class="n">model</span> <span class="k">with</span> <span class="n">resource_values</span><span class="o">}</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-24"></a>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-25"></a><span class="k">let</span> <span class="n">add_resource_value</span> <span class="n">rid</span> <span class="n">delta</span> <span class="n">model</span> <span class="o">=</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-26"></a>  <span class="k">let</span> <span class="k">value</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">+.</span> <span class="n">get_resource_value</span> <span class="n">rid</span> <span class="n">model</span> <span class="k">in</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-27"></a>  <span class="n">set_resource_value</span> <span class="n">rid</span> <span class="k">value</span> <span class="n">model</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-28"></a>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-29"></a>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-30"></a><span class="k">let</span> <span class="n">init_resources_values</span> <span class="o">=</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-31"></a>  <span class="k">let</span> <span class="n">resource_folder</span> <span class="n">rid</span> <span class="o">_</span><span class="n">r</span> <span class="n">acc</span> <span class="o">=</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-32"></a>    <span class="nn">ResourceMap</span><span class="p">.</span><span class="n">add</span> <span class="n">rid</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span> <span class="n">acc</span> <span class="k">in</span>
<a name="rest_code_ad1cfecd7c8f4fc1975a0fa8f94f8bc8-33"></a>  <span class="nn">ResourceMap</span><span class="p">.</span><span class="n">fold</span> <span class="n">resource_folder</span> <span class="n">all_resources</span> <span class="nn">ResourceMap</span><span class="p">.</span><span class="n">empty</span>
</pre>
<p>And since I want to display these, to <tt class="docutils literal">src/overbots_view.ml</tt> and changing the <tt class="docutils literal">view_resources</tt> function to be this:</p>
<pre class="code ocaml"><a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-1"></a><span class="k">let</span> <span class="n">format_value</span> <span class="k">value</span> <span class="o">=</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-2"></a>  <span class="k">if</span> <span class="k">value</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="o">.</span><span class="mi">0</span> <span class="k">then</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-3"></a>    <span class="k">let</span> <span class="n">str</span> <span class="o">=</span> <span class="n">string_of_float</span> <span class="k">value</span> <span class="k">in</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-4"></a>    <span class="k">let</span> <span class="n">str</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="n">str</span> <span class="mi">0</span> <span class="o">(</span><span class="n">min</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">str</span><span class="o">)</span> <span class="mi">6</span><span class="o">)</span> <span class="k">in</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-5"></a>    <span class="n">str</span> <span class="o">^</span> <span class="nn">String</span><span class="p">.</span><span class="n">make</span> <span class="o">(</span><span class="mi">6</span> <span class="o">-</span> <span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">str</span><span class="o">)</span> <span class="sc">'0'</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-6"></a>  <span class="k">else</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-7"></a>    <span class="n">string_of_int</span> <span class="o">(</span><span class="n">int_of_float</span> <span class="k">value</span><span class="o">)</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-8"></a>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-9"></a><span class="k">let</span> <span class="n">view_resources_category_resource</span> <span class="n">model</span> <span class="o">(</span><span class="n">rid</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span> <span class="o">=</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-10"></a>  <span class="k">let</span> <span class="n">r</span> <span class="o">=</span> <span class="nn">Overbots_resource</span><span class="p">.</span><span class="n">get_resource_module</span> <span class="n">rid</span> <span class="k">in</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-11"></a>  <span class="k">let</span> <span class="k">module</span> <span class="nc">R</span> <span class="o">=</span> <span class="o">(</span><span class="k">val</span> <span class="n">r</span><span class="o">)</span> <span class="k">in</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-12"></a>  <span class="k">if</span> <span class="n">not</span> <span class="o">(</span><span class="nn">R</span><span class="p">.</span><span class="n">shown</span> <span class="n">model</span><span class="o">)</span> <span class="k">then</span> <span class="bp">[]</span> <span class="k">else</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-13"></a>  <span class="k">let</span> <span class="k">value</span> <span class="o">=</span> <span class="n">format_value</span> <span class="o">(</span><span class="nn">Overbots_resource</span><span class="p">.</span><span class="n">get_resource_value</span> <span class="n">rid</span> <span class="n">model</span><span class="o">)</span> <span class="k">in</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-14"></a>  <span class="o">[</span> <span class="n">div</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-15"></a>      <span class="o">[</span> <span class="k">class'</span> <span class="o">(</span><span class="s2">"resource resource-"</span><span class="o">^</span><span class="n">id</span><span class="o">)</span> <span class="o">]</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-16"></a>      <span class="o">[</span> <span class="n">div</span> <span class="o">[</span> <span class="k">class'</span> <span class="s2">"resource-name"</span> <span class="o">]</span> <span class="o">[</span> <span class="n">text</span> <span class="n">name</span> <span class="o">]</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-17"></a>      <span class="o">;</span> <span class="n">div</span> <span class="o">[</span> <span class="k">class'</span> <span class="s2">"resource-value"</span> <span class="o">]</span> <span class="o">[</span> <span class="n">text</span> <span class="k">value</span> <span class="o">]</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-18"></a>      <span class="o">]</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-19"></a>  <span class="o">]</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-20"></a>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-21"></a><span class="k">let</span> <span class="n">view_resources_categories</span> <span class="n">model</span> <span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">id</span><span class="o">,</span> <span class="n">resources</span><span class="o">)</span> <span class="o">=</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-22"></a>  <span class="k">let</span> <span class="n">children</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="n">view_resources_category_resource</span> <span class="n">model</span><span class="o">)</span> <span class="n">resources</span> <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">flatten</span> <span class="k">in</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-23"></a>  <span class="k">if</span> <span class="n">children</span> <span class="o">==</span> <span class="bp">[]</span> <span class="k">then</span> <span class="bp">[]</span> <span class="k">else</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-24"></a>  <span class="k">let</span> <span class="n">children</span> <span class="o">=</span> <span class="k">if</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">""</span> <span class="k">then</span> <span class="n">children</span> <span class="k">else</span> <span class="n">div</span> <span class="o">[</span> <span class="k">class'</span> <span class="s2">"category-title"</span> <span class="o">]</span> <span class="o">[</span> <span class="n">text</span> <span class="n">name</span> <span class="o">]</span> <span class="o">::</span> <span class="n">children</span> <span class="k">in</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-25"></a>  <span class="o">[</span> <span class="n">div</span> <span class="o">[</span> <span class="k">class'</span> <span class="o">(</span><span class="s2">"resource-category resource-category-"</span><span class="o">^</span><span class="n">id</span><span class="o">)</span> <span class="o">]</span> <span class="n">children</span> <span class="o">]</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-26"></a>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-27"></a><span class="k">let</span> <span class="n">view_resources</span> <span class="n">model</span> <span class="o">=</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-28"></a>  <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="n">view_resources_categories</span> <span class="n">model</span><span class="o">)</span> <span class="nn">Overbots_resource</span><span class="p">.</span><span class="n">displayed_resources</span>
<a name="rest_code_07efb76d7ff54b8ca81a1910a5b7f1d3-29"></a>  <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">flatten</span>
</pre>
<p>And it displays!  Not formatted at all, so I'm adding some css, replacing the <tt class="docutils literal"><span class="pre">.container-resources</span></tt> block with:</p>
<pre class="code scss"><a name="rest_code_606e5777729c46cea782ab06addf5fd4-1"></a><span class="nc">.container-resources</span> <span class="p">{</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-2"></a>  <span class="nt">flex</span><span class="nd">:</span> <span class="nt">0</span> <span class="nt">0</span> <span class="nt">256px</span><span class="o">;</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-3"></a>  <span class="nt">order</span><span class="nd">:</span> <span class="nt">0</span><span class="o">;</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-4"></a>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-5"></a>  <span class="nc">.category-title</span> <span class="p">{</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-6"></a>    <span class="nt">border-bottom</span><span class="nd">:</span> <span class="nt">solid</span> <span class="nt">1px</span> <span class="nn">#000</span><span class="o">;</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-7"></a>    <span class="nt">flex</span><span class="nd">:</span> <span class="nt">0</span><span class="o">;</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-8"></a>    <span class="nt">font-weight</span><span class="nd">:</span> <span class="nt">bold</span><span class="o">;</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-9"></a>    <span class="nt">text-align</span><span class="nd">:</span> <span class="nt">center</span><span class="o">;</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-10"></a>  <span class="p">}</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-11"></a>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-12"></a>  <span class="nc">.resource</span> <span class="p">{</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-13"></a>    <span class="nt">border</span><span class="nd">:</span> <span class="nt">dashed</span> <span class="nt">1px</span> <span class="nn">#000</span><span class="o">;</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-14"></a>    <span class="nt">display</span><span class="nd">:</span> <span class="nt">flex</span><span class="o">;</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-15"></a>    <span class="nt">flex</span><span class="nd">:</span> <span class="nt">0</span><span class="o">;</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-16"></a>    <span class="nt">flex-direction</span><span class="nd">:</span> <span class="nt">row</span><span class="o">;</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-17"></a>  <span class="p">}</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-18"></a>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-19"></a>  <span class="nc">.resource-name</span> <span class="p">{</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-20"></a>    <span class="nt">display</span><span class="nd">:</span> <span class="nt">flex</span><span class="o">;</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-21"></a>    <span class="nt">flex</span><span class="nd">:</span> <span class="nt">2</span><span class="o">;</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-22"></a>    <span class="nt">font-weight</span><span class="nd">:</span> <span class="nt">bold</span><span class="o">;</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-23"></a>    <span class="nt">width</span><span class="nd">:</span> <span class="nt">50</span><span class="err">%</span><span class="o">;</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-24"></a>  <span class="p">}</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-25"></a>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-26"></a>  <span class="nc">.resource-value</span> <span class="p">{</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-27"></a>    <span class="nt">display</span><span class="nd">:</span> <span class="nt">flex</span><span class="o">;</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-28"></a>    <span class="nt">flex</span><span class="nd">:</span> <span class="nt">1</span><span class="o">;</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-29"></a>    <span class="nt">padding-left</span><span class="nd">:</span> <span class="nt">8px</span><span class="o">;</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-30"></a>  <span class="p">}</span>
<a name="rest_code_606e5777729c46cea782ab06addf5fd4-31"></a><span class="p">}</span>
</pre>
</div>
</div>
<div class="section" id="data-storage">
<h2>Data Storage</h2>
<p>Data storage I want to be type safe and easily able to be passed around, so I think I will use Map's for a lot of these as well.  Primarily a lot of things are going to be 'is this researched', 'is this on', and 'how many of this do I have' and so forth, so I think I will wrap that up into a pattern similar to the resource values as before, very simple:</p>
<pre class="code ocaml"><a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-1"></a><span class="k">type</span> <span class="n">bool_flag</span> <span class="o">=</span>
<a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-2"></a>  <span class="o">|</span> <span class="nc">SolarPanelsReadyToUnfold</span>
<a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-3"></a>  <span class="o">|</span> <span class="nc">SolarPanelsGenerating</span>
<a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-4"></a>  <span class="o">|</span> <span class="nc">DrillDeployed</span>
<a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-5"></a><span class="k">module</span> <span class="nc">BoolFlagSet</span> <span class="o">=</span> <span class="nn">Set</span><span class="p">.</span><span class="nc">Make</span><span class="o">(</span><span class="k">struct</span> <span class="k">type</span> <span class="n">t</span> <span class="o">=</span> <span class="n">bool_flag</span> <span class="k">let</span> <span class="n">compare</span> <span class="o">=</span> <span class="n">compare</span> <span class="k">end</span><span class="o">)</span>
<a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-6"></a><span class="k">type</span> <span class="n">bool_flags</span> <span class="o">=</span> <span class="nn">BoolFlagSet</span><span class="p">.</span><span class="n">t</span>
<a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-7"></a><span class="k">let</span> <span class="n">init_bool_flags</span> <span class="o">=</span> <span class="nn">BoolFlagSet</span><span class="p">.</span><span class="n">empty</span>
<a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-8"></a>
<a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-9"></a>
<a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-10"></a>
<a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-11"></a><span class="k">type</span> <span class="n">int_flag</span> <span class="o">=</span>
<a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-12"></a>  <span class="o">|</span> <span class="nc">NoIntFlagsYet</span>
<a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-13"></a><span class="k">module</span> <span class="nc">IntFlagMap</span> <span class="o">=</span> <span class="nn">Map</span><span class="p">.</span><span class="nc">Make</span><span class="o">(</span><span class="k">struct</span> <span class="k">type</span> <span class="n">t</span> <span class="o">=</span> <span class="n">int_flag</span> <span class="k">let</span> <span class="n">compare</span> <span class="o">=</span> <span class="n">compare</span> <span class="k">end</span><span class="o">)</span>
<a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-14"></a><span class="k">type</span> <span class="n">int_flags</span> <span class="o">=</span> <span class="kt">int</span> <span class="nn">IntFlagMap</span><span class="p">.</span><span class="n">t</span>
<a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-15"></a><span class="k">let</span> <span class="n">init_int_flags</span> <span class="o">=</span>
<a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-16"></a>  <span class="k">let</span> <span class="k">open</span> <span class="nc">IntFlagMap</span> <span class="k">in</span>
<a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-17"></a>  <span class="n">empty</span>
<a name="rest_code_2d198df82a6d4bc9828ba78ede0d4f2c-18"></a>  <span class="o">|&gt;</span> <span class="n">add</span> <span class="nc">NoIntFlagsYet</span> <span class="mi">0</span>
</pre>
<p>Easily expandable by adding to the variants for each.  I could wrap these up into a Functor with a set of helpers, but I'll likely just write helpers inline in another module, in fact let's do that now in <tt class="docutils literal">src/overbots_flags.ml</tt>:</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="#rest_code_a4bdd81f2a074e189e175651afc383f1-1">1</a>
<a href="#rest_code_a4bdd81f2a074e189e175651afc383f1-2">2</a>
<a href="#rest_code_a4bdd81f2a074e189e175651afc383f1-3">3</a>
<a href="#rest_code_a4bdd81f2a074e189e175651afc383f1-4">4</a>
<a href="#rest_code_a4bdd81f2a074e189e175651afc383f1-5">5</a>
<a href="#rest_code_a4bdd81f2a074e189e175651afc383f1-6">6</a>
<a href="#rest_code_a4bdd81f2a074e189e175651afc383f1-7">7</a></pre></div></td>
<td class="code"><pre class="code ocaml"><a name="rest_code_a4bdd81f2a074e189e175651afc383f1-1"></a><span class="k">open</span> <span class="nc">Overbots_types</span>
<a name="rest_code_a4bdd81f2a074e189e175651afc383f1-2"></a>
<a name="rest_code_a4bdd81f2a074e189e175651afc383f1-3"></a><span class="k">let</span> <span class="n">bool_flag_exists</span> <span class="n">fid</span> <span class="n">model</span> <span class="o">=</span>
<a name="rest_code_a4bdd81f2a074e189e175651afc383f1-4"></a>  <span class="nn">BoolFlagSet</span><span class="p">.</span><span class="n">mem</span> <span class="n">fid</span> <span class="n">model</span><span class="o">.</span><span class="n">bool_flags</span>
<a name="rest_code_a4bdd81f2a074e189e175651afc383f1-5"></a>
<a name="rest_code_a4bdd81f2a074e189e175651afc383f1-6"></a><span class="k">let</span> <span class="n">int_flag_value</span> <span class="n">fid</span> <span class="n">model</span> <span class="o">=</span>
<a name="rest_code_a4bdd81f2a074e189e175651afc383f1-7"></a>  <span class="nn">IntFlagMap</span><span class="p">.</span><span class="n">find</span> <span class="n">fid</span> <span class="n">model</span><span class="o">.</span><span class="n">int_flags</span>
</pre></td>
</tr></table>
<p>And changing the main <tt class="docutils literal">model</tt> type to be:</p>
<pre class="code ocaml"><a name="rest_code_8db87a0484c041e79fa597c65c0cb9ab-1"></a><span class="k">type</span> <span class="n">model</span> <span class="o">=</span> <span class="o">{</span>
<a name="rest_code_8db87a0484c041e79fa597c65c0cb9ab-2"></a>  <span class="n">msgs</span> <span class="o">:</span> <span class="n">game_msg</span> <span class="kt">list</span><span class="o">;</span>
<a name="rest_code_8db87a0484c041e79fa597c65c0cb9ab-3"></a>  <span class="n">resource_values</span> <span class="o">:</span> <span class="n">resource_value</span> <span class="nn">ResourceMap</span><span class="p">.</span><span class="n">t</span><span class="o">;</span>
<a name="rest_code_8db87a0484c041e79fa597c65c0cb9ab-4"></a>  <span class="n">bool_flags</span> <span class="o">:</span> <span class="n">bool_flags</span><span class="o">;</span>
<a name="rest_code_8db87a0484c041e79fa597c65c0cb9ab-5"></a>  <span class="n">int_flags</span> <span class="o">:</span> <span class="n">int_flags</span><span class="o">;</span>
<a name="rest_code_8db87a0484c041e79fa597c65c0cb9ab-6"></a><span class="o">}</span>
</pre>
<p>And lastly updating the base <tt class="docutils literal">init</tt> function:</p>
<pre class="code ocaml"><a name="rest_code_babe818b43ca442aa6ad0fb53ad5a476-1"></a><span class="k">let</span> <span class="n">init</span> <span class="bp">()</span> <span class="o">=</span>
<a name="rest_code_babe818b43ca442aa6ad0fb53ad5a476-2"></a>  <span class="k">let</span> <span class="n">model</span> <span class="o">=</span> <span class="o">{</span>
<a name="rest_code_babe818b43ca442aa6ad0fb53ad5a476-3"></a>    <span class="n">msgs</span> <span class="o">=</span> <span class="bp">[]</span><span class="o">;</span>
<a name="rest_code_babe818b43ca442aa6ad0fb53ad5a476-4"></a>    <span class="n">resource_values</span> <span class="o">=</span> <span class="nn">Overbots_resource</span><span class="p">.</span><span class="n">init_resources_values</span><span class="o">;</span>
<a name="rest_code_babe818b43ca442aa6ad0fb53ad5a476-5"></a>    <span class="n">bool_flags</span> <span class="o">=</span> <span class="n">init_bool_flags</span><span class="o">;</span>
<a name="rest_code_babe818b43ca442aa6ad0fb53ad5a476-6"></a>    <span class="n">int_flags</span> <span class="o">=</span> <span class="n">init_int_flags</span><span class="o">;</span>
<a name="rest_code_babe818b43ca442aa6ad0fb53ad5a476-7"></a>  <span class="o">}</span> <span class="k">in</span>
<a name="rest_code_babe818b43ca442aa6ad0fb53ad5a476-8"></a>  <span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span><span class="o">)</span>
</pre>
<p>And running it still reveals the resources, good to go where next time we should start putting in actions and buttons.</p>
</div>
<div class="section" id="result">
<h2>Result</h2>
<p>You can access the output of this post at <a class="reference external" href="dev.html">Overbots Pt3</a>.</p>
<p>And the source is on the <a class="reference external" href="https://github.com/OvermindDL1/overbots/tree/pt3">Overbots Github Pt3</a>.</p>
<p>Check out this entire series via the <a class="reference external" href="../../tags/overbots/">Overbots tag</a>.</p>
</div>
</div>
            </div>
            
    <div class="mdl-grid mdl-card__supporting-text mdl-card--border metadata">
        <div class="mdl-cell mdl-cell--1-col">
          <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--colored mdl-js-ripple-effect">
            
            <img src="https://www.gravatar.com/avatar/5575f10ccc57e0608827fd332448225b" style="width: 100%; height: 100%;"></button>
        </div>
        <div class="mdl-grid mdl-cell mdl-cell--9-col">
            <span class="mdl-cell mdl-cell--12-col site-post__author no-margin-bottom">
                OvermindDL1
            </span>
            <span class="mdl-cell mdl-cell--12-col site-post__date">
                <time class="published dt-published" datetime="2017-05-16T07:08:02-06:00" itemprop="datePublished" title="2017-05-16 07:08">2017-05-16 07:08
                </time></span>
        </div>
        <span class="mdl-cell mdl-cell--2-col site-post__total-comment">
                
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/bucklescript-tea-game-overbots-pt3-game-types.html">Comments</a>


        </span>
    </div>

            
    <div class="mdl-grid mdl-card__actions mdl-card--border">
        
              <a class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-button--accent site-post__tag" rel="tag" title="bucklescript" href="../../tags/bucklescript/">bucklescript</a>
              <a class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-button--accent site-post__tag" rel="tag" title="bucklescript-tea" href="../../tags/bucklescript-tea/">bucklescript-tea</a>
              <a class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-button--accent site-post__tag" rel="tag" title="overbots" href="../../tags/overbots/">overbots</a>

        <div class="section-spacer"></div>
        
    <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored mdl-button--accent site-post__source-link" rel="tag" title="Source" href="index.rst">Source</a>

        

    </div>

            <div class="mdl-color-text--primary-contrast mdl-card__supporting-text comments hidden-print">
                <h2>Comments</h2>
                
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="overblogdl1",
            disqus_url="http://blog.overminddl1.com/posts/bucklescript-tea-game-overbots-pt3-game-types/",
        disqus_title="Bucklescript-Tea Game OverBots Pt.3 - Game Types",
        disqus_identifier="cache/posts/bucklescript-tea-game-overbots-pt3-game-types.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


            </div>
            

        </article>
</div>
    
        <nav class="site-navigation hidden-print pager mdl-cell mdl-cell--12-col"><a href="../bucklescript-tea-game-overbots-pt2-overall-design-and-the-views/" class="site-navigation__button site-navigation__previous" rel="prev" title="Bucklescript-Tea Game Overbots Pt.2 - Overall Design and the View">
                  <button class="mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect">
                    <i class="material-icons" role="presentation">arrow_back</i>
                  </button>
                  Previous post
                </a>
            <div class="section-spacer"></div>
        </nav><script>var disqus_shortname="overblogdl1";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>

            
        <footer id="footer" class="site-footer
mdl-mega-footer
        ">
            Contents  2017 <a href="mailto:overminddl1@overminddl1.com">OvermindDL1</a> 
<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
    <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png"></a>
<br>
This work by
<a xmlns:cc="http://creativecommons.org/ns#" href="http://blog.overminddl1.com/" property="cc:attributionName" rel="cc:attributionURL">
    http://blog.overminddl1.com/
</a>
is licensed under a
<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
    Creative Commons Attribution-NonCommercial 4.0 International License
</a>
.
<br>
Permissions beyond the scope of this license may be available at
<a xmlns:cc="http://creativecommons.org/ns#" href="http://blog.overminddl1.com/" rel="cc:morePermissions">
    http://blog.overminddl1.com/
</a>
.

            
        </footer></main>
</div>
    
        <script src="//storage.googleapis.com/code.getmdl.io/1.1.3/material.min.js"></script><script src="//code.jquery.com/jquery-2.1.4.min.js" type="text/javascript"></script><script src="../../assets/colorbox/js/jquery.colorbox-min.js" type="text/javascript"></script><script>$('.thumbnails a').colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>
</body>
</html>
