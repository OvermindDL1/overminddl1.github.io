<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="Bucklescript-TEA tutorial game OverBots Pt.4 - Actions">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
<title>Bucklescript-Tea Game OverBots Pt.4 - Actions | Hyperglot Programmer</title>
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en" type="text/css">
<link rel="stylesheet" href="//storage.googleapis.com/code.getmdl.io/1.1.3/material.blue_grey-blue.min.css">
<link href="../../assets/colorbox/css/colorbox.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="alternate" type="application/atom+xml" title="Atom" href="../../index.atom">
<link rel="canonical" href="http://blog.overminddl1.com/posts/bucklescript-tea-game-overbots-pt4-actions/">
<meta name="description" content="Bucklescript-TEA tutorial game OverBots Pt.4 - Actions">
<meta name="author" content="OvermindDL1">
<meta name="robots" content="noindex">
<meta property="og:site_name" content="Hyperglot Programmer">
<meta property="og:title" content="Bucklescript-Tea Game OverBots Pt.4 - Actions">
<meta property="og:url" content="http://blog.overminddl1.com/posts/bucklescript-tea-game-overbots-pt4-actions/">
<meta property="og:description" content="Bucklescript-TEA tutorial game OverBots Pt.4 - Actions">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-05-17T06:55:42-06:00">
<meta property="article:tag" content="bucklescript">
<meta property="article:tag" content="bucklescript-tea">
<meta property="article:tag" content="overbots">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container" class="site mdl-layout mdl-js-layout
    ">
         
    <header id="header" class="mdl-layout__header site-header
    "><div class="mdl-layout__header-row site-header__title-row
        ">
            
    <h1 id="brand" class="mdl-layout__title site-title">
        <a href="http://blog.overminddl1.com/" title="Hyperglot Programmer" rel="home">
                <span id="blog-title" class="mdl-color-text--primary-contrast">Hyperglot Programmer</span>
        </a>
    </h1>

            <div class="mdl-layout-spacer"></div>
            <span class="sr-only">main navigation</span>
            <nav class="mdl-navigation site-header__navigation"><a class="mdl-navigation__link" href="../../archives/">Archive</a>
                      <a class="mdl-navigation__link" href="../../categories/">Categories</a>
                      <a class="mdl-navigation__link" href="../../tags/">Tags</a>
                      <a class="mdl-navigation__link" href="../../rss.xml">RSS feed</a>
              
              
            </nav><div class="site-header__search" role="search">
                    
<!-- Google custom search -->
<form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
  <input class="mdl-textfield__input" type="search" id="searchinput"><label class="mdl-textfield__label mdl-color-text--blue-50" for="searchinput">Search...</label>
</div>
<input type="hidden" name="sitesearch" value="http://blog.overminddl1.com/">
</form>
<!-- End of custom search -->

                </div>
            

        </div>
    </header><div id="drawer" class="mdl-layout__drawer site-drawer
mdl-layout--small-screen-only
    ">
        <div class="mdl-layout__title site-drawer__title">
                <span>Hyperglot Programmer</span>
        </div>
        <div class="site-drawer__description">
            
<!-- Google custom search -->
<form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
  <input class="mdl-textfield__input" type="search" id="searchinput"><label class="mdl-textfield__label " for="searchinput">Search...</label>
</div>
<input type="hidden" name="sitesearch" value="http://blog.overminddl1.com/">
</form>
<!-- End of custom search -->

        </div>
        <span class="sr-only">side navigation</span>
        <nav class="mdl-navigation site-drawer__navigation"><a class="mdl-navigation__link" href="../../archives/">Archive</a>
                    <a class="mdl-navigation__link" href="../../categories/">Categories</a>
                    <a class="mdl-navigation__link" href="../../tags/">Tags</a>
                    <a class="mdl-navigation__link" href="../../rss.xml">RSS feed</a>
            
            
        </nav>
</div>

    

         <main id="content" class="mdl-layout__content"><div class="site-post site-card mdl-grid">
    <div class="mdl-card mdl-cell mdl-cell--12-col
    site-post-code
    mdl-shadow--4dp
">
        <article class="h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="mdl-card__media"></div>
            
    
    <div class="mdl-card__title">
        <h1 class="mdl-card__title-text p-name entry-title" itemprop="headline name">Bucklescript-Tea Game OverBots Pt.4 - Actions</h1>
    </div>

    <meta name="description" itemprop="description" content="Bucklescript-TEA tutorial game OverBots Pt.4 - Actions">
<div class="mdl-card__supporting-text e-content entry-content" itemprop="articleBody text">
                <div>
<p>Today I'm going to make this actually do something now, thus actions and buttons!</p>
<!-- TEASER_END -->
<p>To prepare for some of the changes later, I'm adding more helpers for the flags, so <tt class="docutils literal">src/overbots_flags.ml</tt> is changed to become:</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-1"> 1</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-2"> 2</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-3"> 3</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-4"> 4</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-5"> 5</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-6"> 6</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-7"> 7</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-8"> 8</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-9"> 9</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-10">10</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-11">11</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-12">12</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-13">13</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-14">14</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-15">15</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-16">16</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-17">17</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-18">18</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-19">19</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-20">20</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-21">21</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-22">22</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-23">23</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-24">24</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-25">25</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-26">26</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-27">27</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-28">28</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-29">29</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-30">30</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-31">31</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-32">32</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-33">33</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-34">34</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-35">35</a>
<a href="#rest_code_6806313f26bc4492ac3e8b7a334bdca3-36">36</a></pre></div></td>
<td class="code"><pre class="code ocaml"><a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-1"></a><span class="k">open</span> <span class="nc">Overbots_types</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-2"></a>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-3"></a><span class="k">let</span> <span class="n">bool_flag_exists</span> <span class="n">fid</span> <span class="n">model</span> <span class="o">=</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-4"></a>  <span class="nn">BoolFlagSet</span><span class="p">.</span><span class="n">mem</span> <span class="n">fid</span> <span class="n">model</span><span class="o">.</span><span class="n">bool_flags</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-5"></a>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-6"></a><span class="k">let</span> <span class="n">bool_flag_set</span> <span class="n">fid</span> <span class="n">model</span> <span class="o">=</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-7"></a>  <span class="k">let</span> <span class="n">bool_flags</span> <span class="o">=</span> <span class="nn">BoolFlagSet</span><span class="p">.</span><span class="n">add</span> <span class="n">fid</span> <span class="n">model</span><span class="o">.</span><span class="n">bool_flags</span> <span class="k">in</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-8"></a>  <span class="o">{</span><span class="n">model</span> <span class="k">with</span> <span class="n">bool_flags</span><span class="o">}</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-9"></a>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-10"></a><span class="k">let</span> <span class="n">bool_flag_reset</span> <span class="n">fid</span> <span class="n">model</span> <span class="o">=</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-11"></a>  <span class="k">let</span> <span class="n">bool_flags</span> <span class="o">=</span> <span class="nn">BoolFlagSet</span><span class="p">.</span><span class="n">remove</span> <span class="n">fid</span> <span class="n">model</span><span class="o">.</span><span class="n">bool_flags</span> <span class="k">in</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-12"></a>  <span class="o">{</span><span class="n">model</span> <span class="k">with</span> <span class="n">bool_flags</span><span class="o">}</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-13"></a>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-14"></a>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-15"></a><span class="k">let</span> <span class="n">int_flag_value</span> <span class="n">fid</span> <span class="n">model</span> <span class="o">=</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-16"></a>  <span class="nn">IntFlagMap</span><span class="p">.</span><span class="n">find</span> <span class="n">fid</span> <span class="n">model</span><span class="o">.</span><span class="n">int_flags</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-17"></a>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-18"></a><span class="k">let</span> <span class="n">int_flag_set</span> <span class="n">fid</span> <span class="k">value</span> <span class="n">model</span> <span class="o">=</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-19"></a>  <span class="k">let</span> <span class="n">int_flags</span> <span class="o">=</span> <span class="nn">IntFlagMap</span><span class="p">.</span><span class="n">add</span> <span class="n">fid</span> <span class="k">value</span> <span class="n">model</span><span class="o">.</span><span class="n">int_flags</span> <span class="k">in</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-20"></a>  <span class="o">{</span><span class="n">model</span> <span class="k">with</span> <span class="n">int_flags</span><span class="o">}</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-21"></a>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-22"></a><span class="k">let</span> <span class="n">int_flag_add</span> <span class="n">fid</span> <span class="n">delta</span> <span class="n">model</span> <span class="o">=</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-23"></a>  <span class="k">let</span> <span class="k">value</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">+</span> <span class="n">int_flag_value</span> <span class="n">fid</span> <span class="n">model</span> <span class="k">in</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-24"></a>  <span class="n">int_flag_set</span> <span class="n">fid</span> <span class="k">value</span> <span class="n">model</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-25"></a>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-26"></a>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-27"></a><span class="k">let</span> <span class="n">float_flag_value</span> <span class="n">fid</span> <span class="n">model</span> <span class="o">=</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-28"></a>  <span class="nn">FloatFlagMap</span><span class="p">.</span><span class="n">find</span> <span class="n">fid</span> <span class="n">model</span><span class="o">.</span><span class="n">float_flags</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-29"></a>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-30"></a><span class="k">let</span> <span class="n">float_flag_set</span> <span class="n">fid</span> <span class="k">value</span> <span class="n">model</span> <span class="o">=</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-31"></a>  <span class="k">let</span> <span class="n">float_flags</span> <span class="o">=</span> <span class="nn">FloatFlagMap</span><span class="p">.</span><span class="n">add</span> <span class="n">fid</span> <span class="k">value</span> <span class="n">model</span><span class="o">.</span><span class="n">float_flags</span> <span class="k">in</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-32"></a>  <span class="o">{</span><span class="n">model</span> <span class="k">with</span> <span class="n">float_flags</span><span class="o">}</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-33"></a>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-34"></a><span class="k">let</span> <span class="n">float_flag_add</span> <span class="n">fid</span> <span class="n">delta</span> <span class="n">model</span> <span class="o">=</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-35"></a>  <span class="k">let</span> <span class="k">value</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">+.</span> <span class="n">float_flag_value</span> <span class="n">fid</span> <span class="n">model</span> <span class="k">in</span>
<a name="rest_code_6806313f26bc4492ac3e8b7a334bdca3-36"></a>  <span class="n">float_flag_set</span> <span class="n">fid</span> <span class="k">value</span> <span class="n">model</span>
</pre></td>
</tr></table>
<p>As well as I added a <tt class="docutils literal">float</tt> flags as well with appropriate changes to the model and other necessary helpers and areas:</p>
<pre class="code ocaml"><a name="rest_code_76006bbc310c4475be7677b37f7e3994-1"></a><span class="k">type</span> <span class="n">float_flag</span> <span class="o">=</span>
<a name="rest_code_76006bbc310c4475be7677b37f7e3994-2"></a>  <span class="o">|</span> <span class="nc">BasicSolarPanelSelfGeneration</span>
<a name="rest_code_76006bbc310c4475be7677b37f7e3994-3"></a><span class="k">module</span> <span class="nc">FloatFlagMap</span> <span class="o">=</span> <span class="nn">Map</span><span class="p">.</span><span class="nc">Make</span><span class="o">(</span><span class="k">struct</span> <span class="k">type</span> <span class="n">t</span> <span class="o">=</span> <span class="n">float_flag</span> <span class="k">let</span> <span class="n">compare</span> <span class="o">=</span> <span class="n">compare</span> <span class="k">end</span><span class="o">)</span>
<a name="rest_code_76006bbc310c4475be7677b37f7e3994-4"></a><span class="k">type</span> <span class="n">float_flags</span> <span class="o">=</span> <span class="kt">float</span> <span class="nn">IntFlagMap</span><span class="p">.</span><span class="n">t</span>
<a name="rest_code_76006bbc310c4475be7677b37f7e3994-5"></a><span class="k">let</span> <span class="n">init_float_flags</span> <span class="o">=</span>
<a name="rest_code_76006bbc310c4475be7677b37f7e3994-6"></a>  <span class="k">let</span> <span class="k">open</span> <span class="nc">FloatFlagMap</span> <span class="k">in</span>
<a name="rest_code_76006bbc310c4475be7677b37f7e3994-7"></a>  <span class="n">empty</span>
<a name="rest_code_76006bbc310c4475be7677b37f7e3994-8"></a>  <span class="o">|&gt;</span> <span class="n">add</span> <span class="nc">BasicSolarPanelSelfGeneration</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span>
</pre>
<p>I edited the <tt class="docutils literal">int</tt> flags to become:</p>
<pre class="code ocaml"><a name="rest_code_f97fa784e1ee49b7a87d810c9908f28a-1"></a><span class="k">type</span> <span class="n">int_flag</span> <span class="o">=</span>
<a name="rest_code_f97fa784e1ee49b7a87d810c9908f28a-2"></a>  <span class="o">|</span> <span class="nc">TimeActionIdx</span>
</pre>
<p>And I changed the <tt class="docutils literal">bool_flags</tt> to be:</p>
<pre class="code ocaml"><a name="rest_code_4bc140fa87c3427e8b097f45b6c82cbd-1"></a><span class="k">type</span> <span class="n">bool_flag</span> <span class="o">=</span>
<a name="rest_code_4bc140fa87c3427e8b097f45b6c82cbd-2"></a>  <span class="o">|</span> <span class="nc">InternalPowerEnabled</span>
<a name="rest_code_4bc140fa87c3427e8b097f45b6c82cbd-3"></a>  <span class="o">|</span> <span class="nc">SolarPanelsReadyToUnfold</span>
<a name="rest_code_4bc140fa87c3427e8b097f45b6c82cbd-4"></a>  <span class="o">|</span> <span class="nc">SolarPanelsGenerating</span>
<a name="rest_code_4bc140fa87c3427e8b097f45b6c82cbd-5"></a>  <span class="o">|</span> <span class="nc">DrillDeployed</span>
</pre>
<p>I also changed the resources to test for a flag on whether they should be shown or not:</p>
<pre class="code ocaml"><a name="rest_code_2363d74144b44034a427a36a82272183-1"></a><span class="k">open</span> <span class="nc">Overbots_flags</span>
<a name="rest_code_2363d74144b44034a427a36a82272183-2"></a>
<a name="rest_code_2363d74144b44034a427a36a82272183-3"></a><span class="k">module</span> <span class="nc">Energy</span> <span class="o">:</span> <span class="nc">Resource</span> <span class="o">=</span> <span class="k">struct</span>
<a name="rest_code_2363d74144b44034a427a36a82272183-4"></a>  <span class="k">let</span> <span class="n">id</span> <span class="o">=</span> <span class="nc">Energy</span>
<a name="rest_code_2363d74144b44034a427a36a82272183-5"></a>  <span class="k">let</span> <span class="n">shown</span> <span class="n">model</span> <span class="o">=</span> <span class="n">bool_flag_exists</span> <span class="nc">InternalPowerEnabled</span> <span class="n">model</span>
<a name="rest_code_2363d74144b44034a427a36a82272183-6"></a>  <span class="k">let</span> <span class="n">get_value_range</span> <span class="o">_</span><span class="n">model</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">,</span> <span class="mi">100</span><span class="o">.</span><span class="mi">0</span>
<a name="rest_code_2363d74144b44034a427a36a82272183-7"></a><span class="k">end</span>
<a name="rest_code_2363d74144b44034a427a36a82272183-8"></a>
<a name="rest_code_2363d74144b44034a427a36a82272183-9"></a><span class="k">module</span> <span class="nc">IronOxide</span> <span class="o">:</span> <span class="nc">Resource</span> <span class="o">=</span> <span class="k">struct</span>
<a name="rest_code_2363d74144b44034a427a36a82272183-10"></a>  <span class="k">let</span> <span class="n">id</span> <span class="o">=</span> <span class="nc">IronOxide</span>
<a name="rest_code_2363d74144b44034a427a36a82272183-11"></a>  <span class="k">let</span> <span class="n">shown</span> <span class="n">model</span> <span class="o">=</span> <span class="n">bool_flag_exists</span> <span class="nc">DrillDeployed</span> <span class="n">model</span>
<a name="rest_code_2363d74144b44034a427a36a82272183-12"></a>  <span class="k">let</span> <span class="n">get_value_range</span> <span class="o">_</span><span class="n">model</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">,</span> <span class="mi">10</span><span class="o">.</span><span class="mi">0</span>
<a name="rest_code_2363d74144b44034a427a36a82272183-13"></a><span class="k">end</span>
<a name="rest_code_2363d74144b44034a427a36a82272183-14"></a>
<a name="rest_code_2363d74144b44034a427a36a82272183-15"></a><span class="k">module</span> <span class="nc">RawSilicon</span> <span class="o">:</span> <span class="nc">Resource</span> <span class="o">=</span> <span class="k">struct</span>
<a name="rest_code_2363d74144b44034a427a36a82272183-16"></a>  <span class="k">let</span> <span class="n">id</span> <span class="o">=</span> <span class="nc">RawSilicon</span>
<a name="rest_code_2363d74144b44034a427a36a82272183-17"></a>  <span class="k">let</span> <span class="n">shown</span> <span class="n">model</span> <span class="o">=</span> <span class="n">bool_flag_exists</span> <span class="nc">DrillDeployed</span> <span class="n">model</span>
<a name="rest_code_2363d74144b44034a427a36a82272183-18"></a>  <span class="k">let</span> <span class="n">get_value_range</span> <span class="o">_</span><span class="n">model</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">,</span> <span class="mi">2</span><span class="o">.</span><span class="mi">0</span>
<a name="rest_code_2363d74144b44034a427a36a82272183-19"></a><span class="k">end</span>
</pre>
<div class="section" id="time">
<h2>Time</h2>
<p>I now need to add in some time support, so I start by storing it on the model:</p>
<pre class="code ocaml"><a name="rest_code_54bc083962794df894baca3730665b88-1"></a><span class="k">type</span> <span class="n">model</span> <span class="o">=</span> <span class="o">{</span>
<a name="rest_code_54bc083962794df894baca3730665b88-2"></a>  <span class="n">start_realtime</span> <span class="o">:</span> <span class="nn">Tea</span><span class="p">.</span><span class="nn">Time</span><span class="p">.</span><span class="n">t</span><span class="o">;</span>
<a name="rest_code_54bc083962794df894baca3730665b88-3"></a>  <span class="n">current_realtime</span> <span class="o">:</span> <span class="nn">Tea</span><span class="p">.</span><span class="nn">Time</span><span class="p">.</span><span class="n">t</span><span class="o">;</span>
<a name="rest_code_54bc083962794df894baca3730665b88-4"></a>  <span class="n">gametime</span> <span class="o">:</span> <span class="nn">Tea</span><span class="p">.</span><span class="nn">Time</span><span class="p">.</span><span class="n">t</span><span class="o">;</span>
<a name="rest_code_54bc083962794df894baca3730665b88-5"></a>  <span class="n">msgs</span> <span class="o">:</span> <span class="n">game_msg</span> <span class="kt">list</span><span class="o">;</span>
<a name="rest_code_54bc083962794df894baca3730665b88-6"></a>  <span class="n">resource_values</span> <span class="o">:</span> <span class="n">resource_value</span> <span class="nn">ResourceMap</span><span class="p">.</span><span class="n">t</span><span class="o">;</span>
<a name="rest_code_54bc083962794df894baca3730665b88-7"></a>  <span class="n">bool_flags</span> <span class="o">:</span> <span class="n">bool_flags</span><span class="o">;</span>
<a name="rest_code_54bc083962794df894baca3730665b88-8"></a>  <span class="n">int_flags</span> <span class="o">:</span> <span class="n">int_flags</span><span class="o">;</span>
<a name="rest_code_54bc083962794df894baca3730665b88-9"></a>  <span class="n">float_flags</span> <span class="o">:</span> <span class="n">float_flags</span><span class="o">;</span>
<a name="rest_code_54bc083962794df894baca3730665b88-10"></a><span class="o">}</span>
</pre>
<p>And adjusting the <tt class="docutils literal">init</tt> to become:</p>
<pre class="code ocaml"><a name="rest_code_d7b2dac0812245b0b0b78bd1e6e10d8f-1"></a><span class="k">let</span> <span class="n">init</span> <span class="bp">()</span> <span class="o">=</span>
<a name="rest_code_d7b2dac0812245b0b0b78bd1e6e10d8f-2"></a>  <span class="k">let</span> <span class="n">model</span> <span class="o">=</span> <span class="o">{</span>
<a name="rest_code_d7b2dac0812245b0b0b78bd1e6e10d8f-3"></a>    <span class="n">start_realtime</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span>
<a name="rest_code_d7b2dac0812245b0b0b78bd1e6e10d8f-4"></a>    <span class="n">current_realtime</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span>
<a name="rest_code_d7b2dac0812245b0b0b78bd1e6e10d8f-5"></a>    <span class="n">gametime</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">;</span>
<a name="rest_code_d7b2dac0812245b0b0b78bd1e6e10d8f-6"></a>    <span class="n">msgs</span> <span class="o">=</span> <span class="bp">[]</span><span class="o">;</span>
<a name="rest_code_d7b2dac0812245b0b0b78bd1e6e10d8f-7"></a>    <span class="n">resource_values</span> <span class="o">=</span> <span class="nn">Overbots_resource</span><span class="p">.</span><span class="n">init_resources_values</span><span class="o">;</span>
<a name="rest_code_d7b2dac0812245b0b0b78bd1e6e10d8f-8"></a>    <span class="n">bool_flags</span> <span class="o">=</span> <span class="n">init_bool_flags</span><span class="o">;</span>
<a name="rest_code_d7b2dac0812245b0b0b78bd1e6e10d8f-9"></a>    <span class="n">int_flags</span> <span class="o">=</span> <span class="n">init_int_flags</span><span class="o">;</span>
<a name="rest_code_d7b2dac0812245b0b0b78bd1e6e10d8f-10"></a>    <span class="n">float_flags</span> <span class="o">=</span> <span class="n">init_float_flags</span><span class="o">;</span>
<a name="rest_code_d7b2dac0812245b0b0b78bd1e6e10d8f-11"></a>  <span class="o">}</span> <span class="k">in</span>
<a name="rest_code_d7b2dac0812245b0b0b78bd1e6e10d8f-12"></a>  <span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span><span class="o">)</span>
</pre>
<p>And to update the time I need to handle it, so first a message, I change the <tt class="docutils literal">msg</tt> type to become:</p>
<pre class="code ocaml"><a name="rest_code_78bf6bae227444d18508cb76cb9f8651-1"></a><span class="k">type</span> <span class="n">msg</span> <span class="o">=</span>
<a name="rest_code_78bf6bae227444d18508cb76cb9f8651-2"></a>  <span class="o">|</span> <span class="nc">UpdateFrame</span> <span class="k">of</span> <span class="nn">Tea</span><span class="p">.</span><span class="nn">AnimationFrame</span><span class="p">.</span><span class="n">t</span>
<a name="rest_code_78bf6bae227444d18508cb76cb9f8651-3"></a><span class="o">[@@</span><span class="n">bs</span><span class="o">.</span><span class="n">deriving</span> <span class="o">{</span><span class="n">accessors</span><span class="o">}]</span>
</pre>
<p>I'm leaving the deriving accessors on there to auto-create a function that generates those messages, as you see used in the <tt class="docutils literal">subscriptions</tt>, which is now changed to:</p>
<pre class="code ocaml"><a name="rest_code_7ad121b8bc894b1b8241d20b3c35d9e6-1"></a><span class="k">let</span> <span class="n">subscriptions</span> <span class="o">_</span><span class="n">model</span> <span class="o">=</span>
<a name="rest_code_7ad121b8bc894b1b8241d20b3c35d9e6-2"></a>  <span class="nn">Sub</span><span class="p">.</span><span class="n">batch</span> <span class="o">[</span>
<a name="rest_code_7ad121b8bc894b1b8241d20b3c35d9e6-3"></a>    <span class="nn">AnimationFrame</span><span class="p">.</span><span class="n">every</span> <span class="n">updateFrame</span><span class="o">;</span>
<a name="rest_code_7ad121b8bc894b1b8241d20b3c35d9e6-4"></a>  <span class="o">]</span>
</pre>
<p>So on every tick of a frame in the browser it will call the <tt class="docutils literal">UpdateFrame</tt> message with the new time data (I should probably give an option for slower update rates for mobile devices or so), and to handle it I'm changing <tt class="docutils literal">update</tt> to become:</p>
<pre class="code ocaml"><a name="rest_code_3f18b74b5eb44fbfbccb144d0b4ca4a5-1"></a><span class="k">let</span> <span class="n">update</span> <span class="n">model</span> <span class="o">=</span> <span class="k">function</span>
<a name="rest_code_3f18b74b5eb44fbfbccb144d0b4ca4a5-2"></a>  <span class="o">|</span> <span class="nc">UpdateFrame</span> <span class="n">timeinfo</span> <span class="o">-&gt;</span>
<a name="rest_code_3f18b74b5eb44fbfbccb144d0b4ca4a5-3"></a>    <span class="k">let</span> <span class="n">time</span> <span class="o">=</span> <span class="n">timeinfo</span><span class="o">.</span><span class="n">time</span> <span class="o">*.</span> <span class="mi">0</span><span class="o">.</span><span class="mi">001</span> <span class="k">in</span>
<a name="rest_code_3f18b74b5eb44fbfbccb144d0b4ca4a5-4"></a>    <span class="k">let</span> <span class="n">model</span> <span class="o">=</span>
<a name="rest_code_3f18b74b5eb44fbfbccb144d0b4ca4a5-5"></a>      <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">start_realtime</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span> <span class="k">then</span>
<a name="rest_code_3f18b74b5eb44fbfbccb144d0b4ca4a5-6"></a>        <span class="n">model</span>
<a name="rest_code_3f18b74b5eb44fbfbccb144d0b4ca4a5-7"></a>      <span class="k">else</span>
<a name="rest_code_3f18b74b5eb44fbfbccb144d0b4ca4a5-8"></a>        <span class="o">{</span><span class="n">model</span> <span class="k">with</span> <span class="n">start_realtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">;</span> <span class="n">current_realtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">;</span> <span class="n">gametime</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">}</span>
<a name="rest_code_3f18b74b5eb44fbfbccb144d0b4ca4a5-9"></a>    <span class="k">in</span> <span class="nn">Overbots_update</span><span class="p">.</span><span class="n">update_state</span> <span class="n">model</span> <span class="n">time</span>
</pre>
<p>So I massage the milliseconds to seconds and pass it to an <tt class="docutils literal">update_state</tt> function, which I define in a new file of <tt class="docutils literal">src/overbots_update.ml</tt> with the contents of:</p>
<pre class="code ocaml"><a name="rest_code_38416634a3744ac2920d0576160eda12-1"></a><span class="k">open</span> <span class="nc">Tea</span>
<a name="rest_code_38416634a3744ac2920d0576160eda12-2"></a><span class="k">open</span> <span class="nc">Overbots_types</span>
<a name="rest_code_38416634a3744ac2920d0576160eda12-3"></a>
<a name="rest_code_38416634a3744ac2920d0576160eda12-4"></a>
<a name="rest_code_38416634a3744ac2920d0576160eda12-5"></a><span class="k">let</span> <span class="n">update_state</span> <span class="n">model</span> <span class="n">new_time</span> <span class="o">=</span>
<a name="rest_code_38416634a3744ac2920d0576160eda12-6"></a>  <span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span><span class="o">)</span>
</pre>
</div>
<div class="section" id="actions">
<h2>Actions</h2>
<p>Actions are one of the two major systems in an incremental games, these are what is done when a button is clicked or after certain times or other things or so.  It needs to be a variant of actions that can be performed, so let's get started with a basic set of types and how to process them, so in the file <tt class="docutils literal">src/overbots_actions.ml</tt> put:</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-1"> 1</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-2"> 2</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-3"> 3</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-4"> 4</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-5"> 5</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-6"> 6</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-7"> 7</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-8"> 8</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-9"> 9</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-10">10</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-11">11</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-12">12</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-13">13</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-14">14</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-15">15</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-16">16</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-17">17</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-18">18</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-19">19</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-20">20</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-21">21</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-22">22</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-23">23</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-24">24</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-25">25</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-26">26</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-27">27</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-28">28</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-29">29</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-30">30</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-31">31</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-32">32</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-33">33</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-34">34</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-35">35</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-36">36</a>
<a href="#rest_code_01d8b7727afc43eeb1490cbf7494ca7d-37">37</a></pre></div></td>
<td class="code"><pre class="code ocaml"><a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-1"></a><span class="k">open</span> <span class="nc">Overbots_types</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-2"></a><span class="k">open</span> <span class="nc">Overbots_resource</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-3"></a><span class="k">open</span> <span class="nc">Overbots_flags</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-4"></a>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-5"></a><span class="k">type</span> <span class="n">action</span> <span class="o">=</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-6"></a>  <span class="o">|</span> <span class="nc">NoAction</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-7"></a>  <span class="o">|</span> <span class="nc">ActionAddMsg</span> <span class="k">of</span> <span class="kt">string</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-8"></a>  <span class="o">|</span> <span class="nc">ActionAddResourceAmount</span> <span class="k">of</span> <span class="n">resource_flag</span> <span class="o">*</span> <span class="kt">float</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-9"></a>  <span class="o">|</span> <span class="nc">ActionSetBoolFlag</span> <span class="k">of</span> <span class="n">bool_flag</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-10"></a>  <span class="o">|</span> <span class="nc">ActionClearBoolFlag</span> <span class="k">of</span> <span class="n">bool_flag</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-11"></a>  <span class="o">|</span> <span class="nc">ActionSetIntFlag</span> <span class="k">of</span> <span class="n">int_flag</span> <span class="o">*</span> <span class="kt">int</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-12"></a>  <span class="o">|</span> <span class="nc">ActionAddIntFlag</span> <span class="k">of</span> <span class="n">int_flag</span> <span class="o">*</span> <span class="kt">int</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-13"></a>  <span class="o">|</span> <span class="nc">ActionSetFloatFlag</span> <span class="k">of</span> <span class="n">float_flag</span> <span class="o">*</span> <span class="kt">float</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-14"></a>  <span class="o">|</span> <span class="nc">ActionAddFloatFlag</span> <span class="k">of</span> <span class="n">float_flag</span> <span class="o">*</span> <span class="kt">float</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-15"></a>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-16"></a><span class="k">type</span> <span class="n">actions</span> <span class="o">=</span> <span class="n">action</span> <span class="kt">list</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-17"></a>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-18"></a>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-19"></a>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-20"></a><span class="k">let</span> <span class="n">perform_action</span> <span class="n">model</span> <span class="o">=</span> <span class="k">function</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-21"></a>  <span class="o">|</span> <span class="nc">NoAction</span> <span class="o">-&gt;</span> <span class="n">model</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-22"></a>  <span class="o">|</span> <span class="nc">ActionAddMsg</span> <span class="n">msg</span> <span class="o">-&gt;</span> <span class="o">{</span><span class="n">model</span> <span class="k">with</span> <span class="n">msgs</span> <span class="o">=</span> <span class="nc">TimeMsg</span> <span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="n">gametime</span><span class="o">,</span> <span class="n">msg</span><span class="o">)</span> <span class="o">::</span> <span class="n">model</span><span class="o">.</span><span class="n">msgs</span><span class="o">}</span> <span class="c">(* TODO:  Need to make a msgs area *)</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-23"></a>  <span class="o">|</span> <span class="nc">ActionAddResourceAmount</span> <span class="o">(</span><span class="n">rid</span><span class="o">,</span> <span class="n">amt</span><span class="o">)</span> <span class="o">-&gt;</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-24"></a>    <span class="k">begin</span> <span class="k">match</span> <span class="n">add_resource_value</span> <span class="n">rid</span> <span class="n">amt</span> <span class="n">model</span> <span class="k">with</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-25"></a>      <span class="o">|</span> <span class="nc">ValueTooLow</span> <span class="o">-&gt;</span> <span class="n">model</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-26"></a>      <span class="o">|</span> <span class="nc">ValueTooHigh</span> <span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="o">_</span><span class="n">left_over</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">model</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-27"></a>      <span class="o">|</span> <span class="nc">ValueSuccess</span> <span class="n">model</span> <span class="o">-&gt;</span> <span class="n">model</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-28"></a>    <span class="k">end</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-29"></a>  <span class="o">|</span> <span class="nc">ActionSetBoolFlag</span> <span class="n">flag</span> <span class="o">-&gt;</span> <span class="n">bool_flag_set</span> <span class="n">flag</span> <span class="n">model</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-30"></a>  <span class="o">|</span> <span class="nc">ActionClearBoolFlag</span> <span class="n">flag</span> <span class="o">-&gt;</span> <span class="n">bool_flag_reset</span> <span class="n">flag</span> <span class="n">model</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-31"></a>  <span class="o">|</span> <span class="nc">ActionSetIntFlag</span> <span class="o">(</span><span class="n">flag</span><span class="o">,</span> <span class="k">value</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">int_flag_set</span> <span class="n">flag</span> <span class="k">value</span> <span class="n">model</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-32"></a>  <span class="o">|</span> <span class="nc">ActionAddIntFlag</span> <span class="o">(</span><span class="n">flag</span><span class="o">,</span> <span class="n">delta</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">int_flag_add</span> <span class="n">flag</span> <span class="n">delta</span> <span class="n">model</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-33"></a>  <span class="o">|</span> <span class="nc">ActionSetFloatFlag</span> <span class="o">(</span><span class="n">flag</span><span class="o">,</span> <span class="k">value</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">float_flag_set</span> <span class="n">flag</span> <span class="k">value</span> <span class="n">model</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-34"></a>  <span class="o">|</span> <span class="nc">ActionAddFloatFlag</span> <span class="o">(</span><span class="n">flag</span><span class="o">,</span> <span class="n">delta</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">float_flag_add</span> <span class="n">flag</span> <span class="n">delta</span> <span class="n">model</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-35"></a>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-36"></a><span class="k">let</span> <span class="n">perform_actions</span> <span class="n">model</span> <span class="n">actions</span> <span class="o">=</span>
<a name="rest_code_01d8b7727afc43eeb1490cbf7494ca7d-37"></a>  <span class="nn">List</span><span class="p">.</span><span class="n">fold_left</span> <span class="n">perform_action</span> <span class="n">model</span> <span class="n">actions</span>
</pre></td>
</tr></table>
<p>First thing I want to handle are time based actions, so with the type of:</p>
<pre class="code ocaml"><a name="rest_code_fea97c8519f54027b1cc940d9196fcbe-1"></a><span class="k">type</span> <span class="n">timeaction</span> <span class="o">=</span> <span class="o">{</span>
<a name="rest_code_fea97c8519f54027b1cc940d9196fcbe-2"></a>  <span class="n">at</span> <span class="o">:</span> <span class="nn">Tea</span><span class="p">.</span><span class="nn">Time</span><span class="p">.</span><span class="n">t</span><span class="o">;</span>
<a name="rest_code_fea97c8519f54027b1cc940d9196fcbe-3"></a>  <span class="n">actions</span> <span class="o">:</span> <span class="n">actions</span><span class="o">;</span>
<a name="rest_code_fea97c8519f54027b1cc940d9196fcbe-4"></a><span class="o">}</span>
</pre>
<p>I create some timeactions of:</p>
<pre class="code ocaml"><a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-1"></a><span class="k">let</span> <span class="n">init_timeaction</span> <span class="n">at</span> <span class="n">actions</span> <span class="o">=</span> <span class="o">{</span><span class="n">at</span><span class="o">;</span> <span class="n">actions</span><span class="o">}</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-2"></a>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-3"></a><span class="k">let</span> <span class="n">timeactions</span> <span class="o">=</span> <span class="o">[|</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-4"></a><span class="n">init_timeaction</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span> <span class="o">[</span><span class="nc">ActionAddResourceAmount</span> <span class="o">(</span><span class="nc">Energy</span><span class="o">,</span> <span class="mi">100</span><span class="o">.</span><span class="mi">0</span><span class="o">)];</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-5"></a><span class="n">init_timeaction</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span> <span class="o">[</span><span class="nc">ActionAddMsg</span> <span class="s2">"Hmm, what is going on?"</span><span class="o">];</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-6"></a><span class="n">init_timeaction</span> <span class="mi">3</span><span class="o">.</span><span class="mi">0</span> <span class="o">[</span><span class="nc">ActionSetBoolFlag</span> <span class="nc">InternalPowerEnabled</span><span class="o">;</span> <span class="nc">ActionSetFloatFlag</span> <span class="o">(</span><span class="nc">BasicSolarPanelSelfGeneration</span><span class="o">,</span> <span class="mi">100</span><span class="o">.</span><span class="mi">0</span><span class="o">);</span> <span class="nc">ActionAddMsg</span> <span class="s2">"I appear to be getting power through an umbillica interface, however the data connection across it appears to be down..."</span><span class="o">];</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-7"></a><span class="n">init_timeaction</span> <span class="mi">5</span><span class="o">.</span><span class="mi">0</span> <span class="o">[</span><span class="nc">ActionAddMsg</span> <span class="s2">"Running diagnostics..."</span><span class="o">];</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-8"></a><span class="n">init_timeaction</span> <span class="mi">7</span><span class="o">.</span><span class="mi">0</span> <span class="o">[</span><span class="nc">ActionAddMsg</span> <span class="s2">"Minor damage detected, appears to be old micrometeroite impacts, armor has deflected damage from internal systems"</span><span class="o">];</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-9"></a><span class="n">init_timeaction</span> <span class="mi">10</span><span class="o">.</span><span class="mi">0</span> <span class="o">[</span><span class="nc">ActionAddMsg</span> <span class="s2">"Supposed to be getting instructions from the umbillica, and the activation of power from it signifies that I am being activated to work"</span><span class="o">];</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-10"></a><span class="n">init_timeaction</span> <span class="mi">12</span><span class="o">.</span><span class="mi">5</span> <span class="o">[</span><span class="nc">ActionAddMsg</span> <span class="s2">"However, no information has come down, likely the primary craft has been damaged by micrometeroites as well, hence its inability to communicate instructions"</span><span class="o">];</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-11"></a><span class="n">init_timeaction</span> <span class="mi">15</span><span class="o">.</span><span class="mi">0</span> <span class="o">[</span><span class="nc">ActionAddMsg</span> <span class="s2">"Fallback instructions are to acquire resources and prepare for settlement and/or re-acquisition"</span><span class="o">];</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-12"></a><span class="n">init_timeaction</span> <span class="mi">20</span><span class="o">.</span><span class="mi">0</span> <span class="o">[</span><span class="nc">ActionAddMsg</span> <span class="s2">"Velocity sensors are showing that acceleration has not occurred, which should already have happened if I've been reactived"</span><span class="o">];</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-13"></a><span class="n">init_timeaction</span> <span class="mi">25</span><span class="o">.</span><span class="mi">0</span> <span class="o">[</span><span class="nc">ActionAddMsg</span> <span class="s2">"Accelleration is now occurring..."</span><span class="o">];</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-14"></a><span class="n">init_timeaction</span> <span class="mi">30</span><span class="o">.</span><span class="mi">0</span> <span class="o">[</span><span class="nc">ActionAddMsg</span> <span class="s2">"Vector is not changing, which indicates orbital entry is not being accounted for..."</span><span class="o">];</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-15"></a><span class="n">init_timeaction</span> <span class="mi">35</span><span class="o">.</span><span class="mi">0</span> <span class="o">[</span><span class="nc">ActionAddMsg</span> <span class="s2">"Most probable explanation is that the accelleration is from the primary ship entering a planetery atmosphere without the engines firing"</span><span class="o">];</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-16"></a><span class="n">init_timeaction</span> <span class="mi">40</span><span class="o">.</span><span class="mi">0</span> <span class="o">[</span><span class="nc">ActionAddMsg</span> <span class="s2">"The primary ship does have a breaking system that can be deployed in the event of engine failure, the acceleration profile indicates that is what is occuring"</span><span class="o">];</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-17"></a><span class="n">init_timeaction</span> <span class="mi">50</span><span class="o">.</span><span class="mi">0</span> <span class="o">[</span><span class="nc">ActionAddMsg</span> <span class="s2">"Waiting to be deployed..."</span><span class="o">];</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-18"></a><span class="n">init_timeaction</span> <span class="mi">60</span><span class="o">.</span><span class="mi">0</span> <span class="o">[</span><span class="nc">ActionSetFloatFlag</span> <span class="o">(</span><span class="nc">BasicSolarPanelSelfGeneration</span><span class="o">,</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">);</span> <span class="nc">ActionAddMsg</span> <span class="s2">"Confirmed, deployment has started, primary ship has launched me out in the landing assembly, umbillica is detached from the primary ship"</span><span class="o">];</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-19"></a><span class="n">init_timeaction</span> <span class="mi">70</span><span class="o">.</span><span class="mi">0</span> <span class="o">[</span><span class="nc">ActionAddMsg</span> <span class="s2">"Acceleration profile indicates the landing assembly parachutes have been deployed"</span><span class="o">];</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-20"></a><span class="n">init_timeaction</span> <span class="mi">80</span><span class="o">.</span><span class="mi">0</span> <span class="o">[</span><span class="nc">ActionSetBoolFlag</span> <span class="nc">SolarPanelsReadyToUnfold</span><span class="o">;</span><span class="nc">ActionAddMsg</span> <span class="s2">"Touchdown!  Landing assembly is unfolding.  I now need to deploy my solar energy collectors."</span><span class="o">];</span>
<a name="rest_code_1c9a2fa6eb9a4d65ac1e216e4b3937e2-21"></a><span class="o">|]</span>
</pre>
<p>And to process those I write:</p>
<pre class="code ocaml"><a name="rest_code_b74729349fc1493cb3077ff970ee916e-1"></a><span class="k">let</span> <span class="n">update_timeactions</span> <span class="n">model</span> <span class="n">time</span> <span class="o">=</span>
<a name="rest_code_b74729349fc1493cb3077ff970ee916e-2"></a>  <span class="k">let</span> <span class="k">open</span> <span class="nc">Tea</span> <span class="k">in</span>
<a name="rest_code_b74729349fc1493cb3077ff970ee916e-3"></a>  <span class="k">let</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">int_flag_value</span> <span class="nc">TimeActionIdx</span> <span class="n">model</span> <span class="k">in</span>
<a name="rest_code_b74729349fc1493cb3077ff970ee916e-4"></a>  <span class="k">let</span> <span class="o">{</span><span class="n">at</span><span class="o">;</span> <span class="n">actions</span><span class="o">}</span> <span class="o">=</span> <span class="n">timeactions</span><span class="o">.(</span><span class="n">idx</span><span class="o">)</span> <span class="k">in</span>
<a name="rest_code_b74729349fc1493cb3077ff970ee916e-5"></a>  <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="n">at</span> <span class="k">then</span> <span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span><span class="o">)</span> <span class="k">else</span>
<a name="rest_code_b74729349fc1493cb3077ff970ee916e-6"></a>  <span class="k">let</span> <span class="n">model</span> <span class="o">=</span> <span class="n">perform_actions</span> <span class="n">model</span> <span class="n">actions</span> <span class="k">in</span>
<a name="rest_code_b74729349fc1493cb3077ff970ee916e-7"></a>  <span class="k">let</span> <span class="n">model</span> <span class="o">=</span> <span class="n">int_flag_add</span> <span class="nc">TimeActionIdx</span> <span class="mi">1</span> <span class="n">model</span> <span class="k">in</span>
<a name="rest_code_b74729349fc1493cb3077ff970ee916e-8"></a>  <span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span><span class="o">)</span>
</pre>
<p>Which is called from the main <cite>update_state</cite> function by making it this:</p>
<pre class="code ocaml"><a name="rest_code_610180bbcabc444292d5e9d00cfbf72b-1"></a><span class="k">let</span> <span class="n">update_state</span> <span class="n">model</span> <span class="n">new_time</span> <span class="o">=</span>
<a name="rest_code_610180bbcabc444292d5e9d00cfbf72b-2"></a>  <span class="k">let</span> <span class="n">time</span> <span class="o">=</span> <span class="n">new_time</span> <span class="o">-.</span> <span class="n">model</span><span class="o">.</span><span class="n">start_realtime</span> <span class="k">in</span>
<a name="rest_code_610180bbcabc444292d5e9d00cfbf72b-3"></a>  <span class="k">let</span> <span class="n">model</span><span class="o">,</span> <span class="n">ta_cmds</span> <span class="o">=</span> <span class="nn">Overbots_actions</span><span class="p">.</span><span class="n">update_timeactions</span> <span class="n">model</span> <span class="n">time</span> <span class="k">in</span>
<a name="rest_code_610180bbcabc444292d5e9d00cfbf72b-4"></a>  <span class="k">let</span> <span class="n">model</span> <span class="o">=</span> <span class="o">{</span><span class="n">model</span> <span class="k">with</span> <span class="n">gametime</span> <span class="o">=</span> <span class="n">time</span><span class="o">;</span> <span class="n">current_realtime</span> <span class="o">=</span> <span class="n">new_time</span><span class="o">}</span> <span class="k">in</span>
<a name="rest_code_610180bbcabc444292d5e9d00cfbf72b-5"></a>  <span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">batch</span> <span class="o">[</span><span class="n">ta_cmds</span><span class="o">])</span>
</pre>
<p>What this does is just compare the <tt class="docutils literal">timeactions</tt> in order as they get 'used' and run their actions as necessary, so the consequence of this is that the interface starts bare and it starts printing text, a little story of an AI terraformer in the midst of an accidental landing, the energy does not appear until the second message, but you do not see any changes happening to it yet until we make the transformers, which will likely be the next post.</p>
</div>
<div class="section" id="buttons">
<h2>Buttons</h2>
<p>Now let's make the buttons as they are the manual form of actions.  To define them I'll make a variant as usual in the types file of <tt class="docutils literal">src/overbots_types.ml</tt> but I am going to use the variant form that I described in the resources posts that I ended up not using as I went for modules instead, I could do the same thing here, but in effort to show multiple styles (not necessarily the best for a given task) I'll use the variant form here:</p>
<pre class="code ocaml"><a name="rest_code_6692bee6eaf44fabb28df04586ee09f3-1"></a><span class="k">type</span> <span class="n">button_id</span> <span class="o">=</span>
<a name="rest_code_6692bee6eaf44fabb28df04586ee09f3-2"></a>  <span class="o">|</span> <span class="nc">UnfoldSolarPanels</span>
<a name="rest_code_6692bee6eaf44fabb28df04586ee09f3-3"></a>  <span class="o">|</span> <span class="nc">DeployDrill</span>
</pre>
<p>And I'll make a new file to handle its code of <tt class="docutils literal">src/overbots_buttons.ml</tt>:</p>
<table class="codetable"><tr>
<td class="linenos"><div class="linenodiv"><pre><a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-1"> 1</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-2"> 2</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-3"> 3</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-4"> 4</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-5"> 5</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-6"> 6</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-7"> 7</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-8"> 8</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-9"> 9</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-10">10</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-11">11</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-12">12</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-13">13</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-14">14</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-15">15</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-16">16</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-17">17</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-18">18</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-19">19</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-20">20</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-21">21</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-22">22</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-23">23</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-24">24</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-25">25</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-26">26</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-27">27</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-28">28</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-29">29</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-30">30</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-31">31</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-32">32</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-33">33</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-34">34</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-35">35</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-36">36</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-37">37</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-38">38</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-39">39</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-40">40</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-41">41</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-42">42</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-43">43</a>
<a href="#rest_code_38c45b0354224b80aeb3685570bbdc89-44">44</a></pre></div></td>
<td class="code"><pre class="code ocaml"><a name="rest_code_38c45b0354224b80aeb3685570bbdc89-1"></a><span class="k">open</span> <span class="nc">Overbots_types</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-2"></a><span class="k">open</span> <span class="nc">Overbots_actions</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-3"></a><span class="k">open</span> <span class="nc">Overbots_flags</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-4"></a><span class="k">open</span> <span class="nc">Overbots_resource</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-5"></a>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-6"></a>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-7"></a>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-8"></a><span class="k">let</span> <span class="n">displayed_buttons</span> <span class="o">=</span> <span class="o">[</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-9"></a>  <span class="o">(</span><span class="s2">"Perform"</span><span class="o">,</span> <span class="s2">"perform"</span><span class="o">,</span> <span class="o">[</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-10"></a>    <span class="nc">UnfoldSolarPanels</span><span class="o">,</span> <span class="s2">"unfold-solar-panels"</span><span class="o">,</span> <span class="s2">"Unfold Solar Panels"</span><span class="o">;</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-11"></a>    <span class="nc">DeployDrill</span><span class="o">,</span> <span class="s2">"deploy-drill"</span><span class="o">,</span> <span class="s2">"Deploy Drill"</span><span class="o">;</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-12"></a>    <span class="o">]);</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-13"></a><span class="o">]</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-14"></a>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-15"></a>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-16"></a><span class="k">let</span> <span class="n">button_cost</span> <span class="o">_</span><span class="n">model</span> <span class="o">=</span> <span class="k">function</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-17"></a>  <span class="o">|</span> <span class="nc">UnfoldSolarPanels</span> <span class="o">-&gt;</span> <span class="o">[</span><span class="nc">Energy</span><span class="o">,</span> <span class="mi">100</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-18"></a>  <span class="o">|</span> <span class="nc">DeployDrill</span> <span class="o">-&gt;</span> <span class="o">[</span><span class="nc">Energy</span><span class="o">,</span> <span class="mi">50</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-19"></a>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-20"></a>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-21"></a><span class="k">let</span> <span class="n">button_enabled</span> <span class="n">model</span> <span class="o">=</span> <span class="k">function</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-22"></a>  <span class="o">|</span> <span class="nc">UnfoldSolarPanels</span> <span class="o">-&gt;</span> <span class="n">not</span> <span class="o">(</span><span class="n">bool_flag_exists</span> <span class="nc">SolarPanelsGenerating</span> <span class="n">model</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">bool_flag_exists</span> <span class="nc">SolarPanelsReadyToUnfold</span> <span class="n">model</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-23"></a>  <span class="o">|</span> <span class="nc">DeployDrill</span> <span class="o">-&gt;</span> <span class="n">not</span> <span class="o">(</span><span class="n">bool_flag_exists</span> <span class="nc">DrillDeployed</span> <span class="n">model</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">bool_flag_exists</span> <span class="nc">SolarPanelsGenerating</span> <span class="n">model</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-24"></a>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-25"></a>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-26"></a><span class="k">let</span> <span class="n">button_temporarily_disabled</span> <span class="n">model</span> <span class="o">=</span> <span class="k">function</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-27"></a>  <span class="o">|</span> <span class="nc">DeployDrill</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="n">cost_resources</span> <span class="o">(</span><span class="n">button_cost</span> <span class="n">model</span> <span class="nc">DeployDrill</span><span class="o">)</span> <span class="n">model</span><span class="o">)</span> <span class="o">==</span> <span class="nc">None</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-28"></a>  <span class="o">|</span> <span class="o">_</span><span class="n">button</span> <span class="o">-&gt;</span> <span class="bp">false</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-29"></a>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-30"></a>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-31"></a><span class="k">let</span> <span class="n">button_actions</span> <span class="o">_</span><span class="n">model</span> <span class="o">=</span> <span class="k">function</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-32"></a>  <span class="o">|</span> <span class="nc">UnfoldSolarPanels</span> <span class="o">-&gt;</span> <span class="o">[</span><span class="nc">ActionSetBoolFlag</span> <span class="nc">SolarPanelsGenerating</span><span class="o">;</span> <span class="nc">ActionClearBoolFlag</span> <span class="nc">SolarPanelsReadyToUnfold</span><span class="o">;</span> <span class="nc">ActionAddMsg</span> <span class="s2">"Energy is now being generated, now to acquire simple minerals by drilling"</span><span class="o">]</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-33"></a>  <span class="o">|</span> <span class="nc">DeployDrill</span> <span class="o">-&gt;</span> <span class="o">[</span><span class="nc">ActionSetBoolFlag</span> <span class="nc">DrillDeployed</span><span class="o">;</span> <span class="nc">ActionAddMsg</span> <span class="s2">"Now that I've started acquiring resources I need to active my internal refineries to prepare the resources for use"</span><span class="o">]</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-34"></a>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-35"></a>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-36"></a><span class="k">let</span> <span class="n">perform_button</span> <span class="n">orig_model</span> <span class="n">id</span> <span class="o">=</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-37"></a>  <span class="k">let</span> <span class="k">open</span> <span class="nc">Tea</span> <span class="k">in</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-38"></a>  <span class="k">if</span> <span class="n">not</span> <span class="o">(</span><span class="n">button_enabled</span> <span class="n">orig_model</span> <span class="n">id</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span><span class="n">button_temporarily_disabled</span> <span class="n">orig_model</span> <span class="n">id</span><span class="o">)</span> <span class="k">then</span> <span class="o">(</span><span class="n">orig_model</span><span class="o">,</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span><span class="o">)</span> <span class="k">else</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-39"></a>    <span class="k">match</span> <span class="n">cost_resources</span> <span class="o">(</span><span class="n">button_cost</span> <span class="n">orig_model</span> <span class="n">id</span><span class="o">)</span> <span class="n">orig_model</span> <span class="k">with</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-40"></a>    <span class="o">|</span> <span class="nc">None</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="n">orig_model</span><span class="o">,</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span><span class="o">)</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-41"></a>    <span class="o">|</span> <span class="nc">Some</span> <span class="n">model</span> <span class="o">-&gt;</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-42"></a>      <span class="k">let</span> <span class="n">model</span> <span class="o">=</span> <span class="n">perform_actions</span> <span class="n">model</span> <span class="o">(</span><span class="n">button_actions</span> <span class="n">model</span> <span class="n">id</span><span class="o">)</span> <span class="k">in</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-43"></a>      <span class="k">match</span> <span class="n">id</span> <span class="k">with</span>
<a name="rest_code_38c45b0354224b80aeb3685570bbdc89-44"></a>      <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">none</span><span class="o">)</span>
</pre></td>
</tr></table>
<p>I created the button variant in the types and here instead of modules I use a variety of function calls that match on the types and I call them to do the actions.  This ends up compiling to a case statement in javascript so about on par with a function call too.  I set up a few things to have buttons be enabled or not, to show disabled (like if short on resources), and what actions to perform when clicked, and I also left a mostly empty match context at the bottom of perform_button so I can do something with a button click that is not handleable by actions if the case to do so arrives.</p>
<p>Since buttons will be visible on the page I made another <tt class="docutils literal">displayed_buttons</tt> to hold how it shows, I'm adding categories to them as well as they can be quite useful later, might make tabs or something on the page for them, but for now I'll display it similar to how I display the resources so I change <tt class="docutils literal">view_buttons</tt> to this:</p>
<pre class="code ocaml"><a name="rest_code_72e356110ddd4458b9110808861331bb-1"></a><span class="k">let</span> <span class="n">view_button</span> <span class="n">model</span> <span class="o">(</span><span class="n">bid</span><span class="o">,</span> <span class="n">id</span><span class="o">,</span> <span class="n">name</span><span class="o">)</span> <span class="o">=</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-2"></a>  <span class="k">let</span> <span class="k">open</span> <span class="nc">Overbots_buttons</span> <span class="k">in</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-3"></a>  <span class="k">if</span> <span class="n">button_enabled</span> <span class="n">model</span> <span class="n">bid</span> <span class="k">then</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-4"></a>    <span class="o">[</span> <span class="n">button</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-5"></a>        <span class="o">[</span> <span class="n">onClick</span> <span class="o">(</span><span class="nc">ActionButtonClicked</span> <span class="n">bid</span><span class="o">)</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-6"></a>        <span class="o">;</span> <span class="nn">Attributes</span><span class="p">.</span><span class="n">disabled</span> <span class="o">(</span><span class="n">button_temporarily_disabled</span> <span class="n">model</span> <span class="n">bid</span><span class="o">)</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-7"></a>        <span class="o">;</span> <span class="k">class'</span> <span class="o">(</span><span class="s2">"action-button action-button-"</span> <span class="o">^</span> <span class="n">id</span><span class="o">)</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-8"></a>        <span class="o">]</span> <span class="o">[</span> <span class="n">text</span> <span class="n">name</span> <span class="o">]</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-9"></a>    <span class="o">]</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-10"></a>  <span class="k">else</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-11"></a>    <span class="bp">[]</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-12"></a>
<a name="rest_code_72e356110ddd4458b9110808861331bb-13"></a><span class="k">let</span> <span class="n">view_buttons_category</span> <span class="n">model</span> <span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">id</span><span class="o">,</span> <span class="n">buttons</span><span class="o">)</span> <span class="o">=</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-14"></a>  <span class="k">let</span> <span class="n">children</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="n">view_button</span> <span class="n">model</span><span class="o">)</span> <span class="n">buttons</span> <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">flatten</span> <span class="k">in</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-15"></a>  <span class="k">if</span> <span class="n">children</span> <span class="o">==</span> <span class="bp">[]</span> <span class="k">then</span> <span class="bp">[]</span> <span class="k">else</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-16"></a>  <span class="k">let</span> <span class="n">children</span> <span class="o">=</span> <span class="n">div</span> <span class="o">[</span> <span class="k">class'</span> <span class="s2">"category-title"</span> <span class="o">]</span> <span class="o">[</span> <span class="n">text</span> <span class="n">name</span> <span class="o">]</span> <span class="o">::</span> <span class="n">children</span> <span class="k">in</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-17"></a>  <span class="o">[</span> <span class="n">div</span> <span class="o">[</span> <span class="k">class'</span> <span class="o">(</span><span class="s2">"button-category button-category-"</span><span class="o">^</span><span class="n">id</span><span class="o">)</span> <span class="o">]</span> <span class="n">children</span> <span class="o">]</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-18"></a>
<a name="rest_code_72e356110ddd4458b9110808861331bb-19"></a><span class="k">let</span> <span class="n">view_buttons</span> <span class="n">model</span> <span class="o">=</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-20"></a>  <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="n">view_buttons_category</span> <span class="n">model</span><span class="o">)</span> <span class="nn">Overbots_buttons</span><span class="p">.</span><span class="n">displayed_buttons</span>
<a name="rest_code_72e356110ddd4458b9110808861331bb-21"></a>  <span class="o">|&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">flatten</span>
</pre>
<p>And I know CSS is boring, but here is the new css for <tt class="docutils literal"><span class="pre">.container-actions</span></tt> for completion:</p>
<pre class="code scss"><a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-1"></a><span class="nc">.container-actions</span> <span class="p">{</span>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-2"></a>  <span class="nt">flex</span><span class="nd">:</span> <span class="nt">0</span> <span class="nt">0</span> <span class="nt">256px</span><span class="o">;</span>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-3"></a>  <span class="nt">order</span><span class="nd">:</span> <span class="nt">2</span><span class="o">;</span>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-4"></a>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-5"></a>  <span class="nc">.action-category</span> <span class="p">{</span>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-6"></a>    <span class="nt">display</span><span class="nd">:</span> <span class="nt">flex</span><span class="o">;</span>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-7"></a>    <span class="nt">flex-direction</span><span class="nd">:</span> <span class="nt">column</span><span class="o">;</span>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-8"></a>  <span class="p">}</span>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-9"></a>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-10"></a>  <span class="nc">.category-title</span> <span class="p">{</span>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-11"></a>    <span class="nt">border-bottom</span><span class="nd">:</span> <span class="nt">solid</span> <span class="nt">1px</span> <span class="nn">#000</span><span class="o">;</span>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-12"></a>    <span class="nt">flex</span><span class="nd">:</span> <span class="nt">0</span><span class="o">;</span>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-13"></a>    <span class="nt">font-weight</span><span class="nd">:</span> <span class="nt">bold</span><span class="o">;</span>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-14"></a>    <span class="nt">text-align</span><span class="nd">:</span> <span class="nt">center</span><span class="o">;</span>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-15"></a>  <span class="p">}</span>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-16"></a>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-17"></a>  <span class="nc">.action-button</span> <span class="p">{</span>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-18"></a>    <span class="nt">flex</span><span class="nd">:</span> <span class="nt">1</span><span class="o">;</span>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-19"></a>  <span class="p">}</span>
<a name="rest_code_705843bde8da4b51ba43a0c9b6b86086-20"></a><span class="p">}</span>
</pre>
<p>And with this now done with the first of two major systems in an incremental game, the next post will be about the second, which is Transformation Of Resources.  The example takes about 80 seconds to run to completion considering the mini-story built above in <tt class="docutils literal">timeactions</tt>, but it shows how it all works.</p>
</div>
<div class="section" id="result">
<h2>Result</h2>
<p>You can access the output of this post at <a class="reference external" href="dev.html">Overbots Pt4</a>.</p>
<p>And the source is on the <a class="reference external" href="https://github.com/OvermindDL1/overbots/tree/pt4">Overbots Github Pt4</a>.</p>
<p>Check out this entire series via the <a class="reference external" href="../../tags/overbots/">Overbots tag</a>.</p>
</div>
</div>
            </div>
            
    <div class="mdl-grid mdl-card__supporting-text mdl-card--border metadata">
        <div class="mdl-cell mdl-cell--1-col">
          <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--colored mdl-js-ripple-effect">
            
            <img src="https://www.gravatar.com/avatar/5575f10ccc57e0608827fd332448225b" style="width: 100%; height: 100%;"></button>
        </div>
        <div class="mdl-grid mdl-cell mdl-cell--9-col">
            <span class="mdl-cell mdl-cell--12-col site-post__author no-margin-bottom">
                OvermindDL1
            </span>
            <span class="mdl-cell mdl-cell--12-col site-post__date">
                <time class="published dt-published" datetime="2017-05-17T06:55:42-06:00" itemprop="datePublished" title="2017-05-17 06:55">2017-05-17 06:55
                </time></span>
        </div>
        <span class="mdl-cell mdl-cell--2-col site-post__total-comment">
                
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/bucklescript-tea-game-overbots-pt4-actions.html">Comments</a>


        </span>
    </div>

            
    <div class="mdl-grid mdl-card__actions mdl-card--border">
        
              <a class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-button--accent site-post__tag" rel="tag" title="bucklescript" href="../../tags/bucklescript/">bucklescript</a>
              <a class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-button--accent site-post__tag" rel="tag" title="bucklescript-tea" href="../../tags/bucklescript-tea/">bucklescript-tea</a>
              <a class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-button--accent site-post__tag" rel="tag" title="overbots" href="../../tags/overbots/">overbots</a>

        <div class="section-spacer"></div>
        
    <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored mdl-button--accent site-post__source-link" rel="tag" title="Source" href="index.rst">Source</a>

        

    </div>

            <div class="mdl-color-text--primary-contrast mdl-card__supporting-text comments hidden-print">
                <h2>Comments</h2>
                
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="overblogdl1",
            disqus_url="http://blog.overminddl1.com/posts/bucklescript-tea-game-overbots-pt4-actions/",
        disqus_title="Bucklescript-Tea Game OverBots Pt.4 - Actions",
        disqus_identifier="cache/posts/bucklescript-tea-game-overbots-pt4-actions.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


            </div>
            

        </article>
</div>
    

    
        
       <script>var disqus_shortname="overblogdl1";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>

            
        <footer id="footer" class="site-footer
mdl-mega-footer
        ">
            Contents © 2017 <a href="mailto:overminddl1@overminddl1.com">OvermindDL1</a> 
<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
    <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png"></a>
<br>
This work by
<a xmlns:cc="http://creativecommons.org/ns#" href="http://blog.overminddl1.com/" property="cc:attributionName" rel="cc:attributionURL">
    http://blog.overminddl1.com/
</a>
is licensed under a
<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
    Creative Commons Attribution-NonCommercial 4.0 International License
</a>
.
<br>
Permissions beyond the scope of this license may be available at
<a xmlns:cc="http://creativecommons.org/ns#" href="http://blog.overminddl1.com/" rel="cc:morePermissions">
    http://blog.overminddl1.com/
</a>
.

            
        </footer></main>
</div>
    
        <script src="//storage.googleapis.com/code.getmdl.io/1.1.3/material.min.js"></script><script src="//code.jquery.com/jquery-2.1.4.min.js" type="text/javascript"></script><script src="../../assets/colorbox/js/jquery.colorbox-min.js" type="text/javascript"></script><script>$('.thumbnails a').colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>
</body>
</html>
